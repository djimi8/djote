<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš–ï¸ Ù…Ø³Ø§Ø¹Ø¯ Ø·Ù„Ø¨Ø© Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: slide 20s linear infinite;
        }

        @keyframes slide {
            0% { transform: translateX(-50px) translateY(-50px); }
            100% { transform: translateX(50px) translateY(50px); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            min-width: 200px;
        }

        .tab:hover {
            background: #e9ecef;
            color: #007bff;
        }

        .tab.active {
            background: white;
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .generate-btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px auto;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,123,255,0.4);
        }

        .generate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .result-container {
            display: none;
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .result-container.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .result-header h3 {
            margin: 0;
            font-size: 1.5em;
        }

        .action-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        #result {
            padding: 30px;
            background: white;
            max-height: 600px;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.8;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }



        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #f5c6cb;
        }

        .error h4 {
            margin-bottom: 10px;
        }

        .highlight-box {
            background: linear-gradient(45deg, #e3f2fd, #f3e5f5);
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .highlight-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 40px 30px;
            background: #f8f9fa;
        }

        .feature {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .feature h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .feature p {
            color: #6c757d;
            line-height: 1.6;
        }

        .api-key-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .api-key-section h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-key-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            transition: border-color 0.3s ease;
        }

        .api-key-section input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }

        .api-key-section button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .api-key-section button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .api-key-section button:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tab {
                min-width: 150px;
                font-size: 14px;
                padding: 12px 15px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš–ï¸ Ù…Ø³Ø§Ø¹Ø¯ Ø·Ù„Ø¨Ø© Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø°ÙƒÙŠ</h1>
            <p>Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø·Ù„Ø¨Ø© Ø§Ù„Ø­Ù‚ÙˆÙ‚ ÙÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© ÙˆØ§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ­Ø¶ÙŠØ±</p>
            <div style="background: rgba(40, 167, 69, 0.1); border: 1px solid rgba(40, 167, 69, 0.3); border-radius: 10px; padding: 15px; margin-top: 20px; position: relative; z-index: 1;">
                <div style="display: flex; align-items: center; gap: 10px; color: #28a745; font-weight: 600;">
                    <span style="font-size: 1.2em;">âœ…</span>
                    <span>Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… - Ù…ÙØªØ§Ø­ API Ù…ÙØ¹Ù„</span>
                </div>
                <p style="font-size: 14px; color: #6c757d; margin: 5px 0 0 0;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¶Ø§ÙÙŠ</p>
            </div>
                <p style="font-size: 14px; color: #6c757d; margin: 5px 0 0 0;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¶Ø§ÙÙŠ</p>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØªØ§Ø­ API - Ù…Ø®ÙÙŠ Ù„Ù„Ø£Ù…Ø§Ù† -->
            <div class="api-key-section" style="display: none;">
                <h4>ğŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØªØ§Ø­ API Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h4>
                <p style="font-size: 14px; color: #6c757d;">Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Google AI Studio: <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #007bff;">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</a></p>
                <p style="font-size: 12px; color: #28a745; margin: 5px 0;">ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø¨Ø¹Ø¯ Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† GoogleØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± ğŸ“‹ Ø£Ùˆ Ctrl+V Ù„Ù„ØµÙ‚</p>
                <p style="font-size: 11px; color: #6c757d; margin: 5px 0;">ğŸ” Ù„Ù„ØªØ´Ø®ÙŠØµ: Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©" Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­</p>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px; position: relative;">
                        <input type="text" id="api-key" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù…ÙØªØ§Ø­ API Ù‡Ù†Ø§..." style="width: 100% !important; padding: 12px 80px 12px 12px !important; box-sizing: border-box !important; border: 1px solid #ddd !important; border-radius: 5px !important; font-size: 14px !important; outline: none !important; margin: 0 !important;" />
                        <button onclick="pasteApiKey()" style="position: absolute; right: 40px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 14px; color: #007bff; z-index: 10;" title="Ù„ØµÙ‚ Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©">ğŸ“‹</button>
                        <button onclick="togglePasswordVisibility()" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 16px; z-index: 10;" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­">ğŸ‘ï¸</button>
                    </div>
                    <button onclick="saveApiKey()" style="white-space: nowrap;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­</button>
                    <button onclick="testApiKey()" style="white-space: nowrap; background: #28a745;">ğŸ” Ø§Ø®ØªØ¨Ø§Ø±</button>
                    <button onclick="checkApiKeyStatus()" style="white-space: nowrap; background: #17a2b8;">â„¹ï¸ ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©</button>
                    <button onclick="clearApiKey()" style="white-space: nowrap; background: #dc3545;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
                <p style="font-size: 12px; color: #6c757d; margin-top: 10px;">Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙØ±Ø³Ù„ Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù…</p>
                <div id="api-status" style="margin-top: 10px; padding: 10px; border-radius: 5px; display: none;"></div>
                <div id="debug-info" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 11px; color: #6c757d; display: none;">
                    <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong>
                    <div id="debug-content"></div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('research')">ğŸ“š ÙƒØªØ§Ø¨Ø© Ø¨Ø­Ø« Ù‚Ø§Ù†ÙˆÙ†ÙŠ</button>
            <button class="tab" onclick="switchTab('summary')">ğŸ“ ØªÙ„Ø®ÙŠØµ Ø§Ù„Ø¯Ø±ÙˆØ³</button>
            <button class="tab" onclick="switchTab('preparation')">ğŸ“‹ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨Ø­Ø«</button>
        </div>

        <div id="research-tab" class="tab-content active">
            <div class="form-row">
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«</label>
                    <input type="text" id="research-title" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ÙˆØ®ØµØ§Ø¦ØµÙ‡">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¨Ø­Ø«</label>
                    <select id="research-field">
                        <option value="">Ø§Ø®ØªØ± ÙØ±Ø¹ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ù…Ø¯Ù†ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¬Ù†Ø§Ø¦ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¥Ø¯Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† ØªØ¬Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø³ØªÙˆØ±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯Ø³ØªÙˆØ±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¯ÙˆÙ„ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¹Ù…Ù„">Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¹Ù…Ù„</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø£Ø³Ø±Ø©">Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø£Ø³Ø±Ø©</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ù…Ø§Ù„ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø§Ù„ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¹Ù‚Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¨Ø­Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¨Ø­Ø±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¬ÙˆÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬ÙˆÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¨ÙŠØ¦Ø©">Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¨ÙŠØ¦Ø©</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©">Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</label>
                    <select id="research-level">
                        <option value="Ø³Ù†Ø©-Ø£ÙˆÙ„Ù‰">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø­Ù‚ÙˆÙ‚</option>
                        <option value="Ø³Ù†Ø©-Ø«Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø­Ù‚ÙˆÙ‚</option>
                        <option value="Ø³Ù†Ø©-Ø«Ø§Ù„Ø«Ø©">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø­Ù‚ÙˆÙ‚</option>
                        <option value="Ù…Ø§Ø³ØªØ±">Ø§Ù„Ù…Ø§Ø³ØªØ±</option>
                        <option value="Ø¯ÙƒØªÙˆØ±Ø§Ù‡">Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                    <select id="page-count">
                        <option value="5-10">5-10 ØµÙØ­Ø§Øª</option>
                        <option value="10-15">10-15 ØµÙØ­Ø©</option>
                        <option value="15-20">15-20 ØµÙØ­Ø©</option>
                        <option value="20-30">20-30 ØµÙØ­Ø©</option>
                        <option value="30+">Ø£ÙƒØ«Ø± Ù…Ù† 30 ØµÙØ­Ø©</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <textarea id="additional-requirements" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø±Ø§Ø¬Ø¹ Ø­Ø¯ÙŠØ«Ø©ØŒ ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø§Øª Ø¹Ù…Ù„ÙŠØ©..."></textarea>
            </div>

            <div class="action-buttons">
                <button class="generate-btn" onclick="generateAcademicResearch()">
                    ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ
                </button>
                <button class="generate-btn" onclick="resetForm()" style="background: #95a5a6; margin-right: 10px;">
                    ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ ØªÙ„Ø®ÙŠØµ Ø§Ù„Ø¯Ø±ÙˆØ³ -->
        <div id="summary-tab" class="tab-content">
            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="subject-select">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                        <option value="Ù…Ø¯Ø®Ù„ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©">Ù…Ø¯Ø®Ù„ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</option>
                        <option value="Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠ</option>
                        <option value="Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
                        <option value="Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</option>
                        <option value="Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯Ø³ØªÙˆØ±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯Ø³ØªÙˆØ±ÙŠ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø·ÙˆÙ„ Ø§Ù„ØªÙ„Ø®ÙŠØµ</label>
                    <select id="summary-length">
                        <option value="Ù‚ØµÙŠØ±">Ù‚ØµÙŠØ± (ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©)</option>
                        <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø· (2-3 ØµÙØ­Ø§Øª)</option>
                        <option value="Ù…ÙØµÙ„">Ù…ÙØµÙ„ (4-5 ØµÙØ­Ø§Øª)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ„Ø®ÙŠØµ</label>
                <select id="summary-level">
                    <option value="Ù…Ø¨Ø³Ø·">Ù…Ø¨Ø³Ø· (Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†)</option>
                    <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø· (Ù„Ù„Ø·Ù„Ø§Ø¨)</option>
                    <option value="Ù…ØªÙ‚Ø¯Ù…">Ù…ØªÙ‚Ø¯Ù… (Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
                <textarea id="lesson-content" placeholder="Ø§Ù„ØµÙ‚ Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙ„Ø®ÙŠØµÙ‡ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªÙ„Ø®ÙŠØµÙ‡..."></textarea>
            </div>
            <button class="generate-btn" onclick="generateSummary()">
                ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ø®ÙŠØµ
            </button>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨Ø­Ø« -->
        <div id="preparation-tab" class="tab-content">
            <div class="form-row">
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«</label>
                    <input type="text" id="prep-title" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ø¹Ù‚ÙˆØ¯">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¨Ø­Ø«</label>
                    <select id="prep-field">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ø§Ù„</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ù…Ø¯Ù†ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¬Ù†Ø§Ø¦ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¥Ø¯Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† ØªØ¬Ø§Ø±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø³ØªÙˆØ±ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯Ø³ØªÙˆØ±ÙŠ</option>
                        <option value="Ù‚Ø§Ù†ÙˆÙ† Ø¯ÙˆÙ„ÙŠ">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ±</label>
                    <select id="prep-type">
                        <option value="Ø®Ø·Ø©">Ø®Ø·Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø·</option>
                        <option value="Ù…Ø±Ø§Ø¬Ø¹">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</option>
                        <option value="Ø£Ø³Ø¦Ù„Ø©">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</option>
                        <option value="Ø´Ø§Ù…Ù„">ØªØ­Ø¶ÙŠØ± Ø´Ø§Ù…Ù„</option>
                    </select>
                </div>
            </div>
            <button class="generate-btn" onclick="generatePreparation()">
                ğŸ“‹ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±
            </button>
        </div>

        <div id="result-container" class="result-container">
            <div class="result-header">
                <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«</h3>
                <div class="action-buttons">
                    <button class="action-btn copy-btn" onclick="copyResult()">ğŸ“‹ Ù†Ø³Ø®</button>
                    <button class="action-btn download-btn" onclick="downloadResult()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„</button>
                    <button class="action-btn print-btn" onclick="printResult()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                </div>
            </div>
            <div id="result"></div>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">ğŸ¯</div>
                <h4>Ø¨Ø­Ø« Ù…ØªØ®ØµØµ</h4>
                <p>ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ“š</div>
                <h4>Ù…Ø±Ø§Ø¬Ø¹ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</h4>
                <p>ÙŠØªØ¶Ù…Ù† Ù…Ø±Ø§Ø¬Ø¹ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…ÙˆØ«ÙˆÙ‚Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…Ø³ØªÙˆÙ‰</p>
            </div>
            <div class="feature">
                <div class="feature-icon">âš–ï¸</div>
                <h4>ØµÙŠØ§ØºØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©</h4>
                <p>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ“</div>
                <h4>ØªÙ†Ø³ÙŠÙ‚ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</h4>
                <p>ØªÙ†Ø³ÙŠÙ‚ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø£Ø¨Ø­Ø§Ø« Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</p>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'research';
        let backupApiKey = null; // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ localStorage

        // Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ - Ù…Ø¶Ù…Ù† Ù„Ù„Ø£Ù…Ø§Ù†
        let apiKeyGlobal = 'AIzaSyAr2FfARE_lCHpk3aZr4qCOyKQOgCrcZgA';

        // Ø­ÙØ¸ Ù…ÙØªØ§Ø­ API
        function saveApiKey() {
            const apiKeyInput = document.getElementById('api-key');
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API');
                return;
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
            apiKeyGlobal = apiKey;
            console.log('API key saved in global variable:', apiKeyGlobal ? 'SUCCESS' : 'FAILED');
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ÙØ¸ ÙÙŠ localStorage
            try {
                localStorage.setItem('gemini_api_key', apiKey);
                console.log('âœ… API key saved in localStorage');
            } catch (error) {
                console.warn('localStorage not available:', error);
            }
            
            // Ø§Ø®ØªØ¨Ø§Ø± ÙÙˆØ±ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­ÙØ¸
            const testKey = getApiKey();
            console.log('Immediate test after save:', testKey ? 'SUCCESS' : 'FAILED');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            apiKeyInput.value = '';
            apiKeyInput.placeholder = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ âœ…';
            apiKeyInput.style.borderColor = '#28a745';
            
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙØªØ§Ø­ API Ø¨Ù†Ø¬Ø§Ø­!');
            console.log('âœ… API key saved successfully');
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ API
        function getApiKey() {
            // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø¶Ù…Ù† ÙÙŠ Ø§Ù„ÙƒÙˆØ¯
            return apiKeyGlobal;
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙØªØ§Ø­ API
        async function testApiKey() {
            const apiKey = getApiKey();
            
            if (!apiKey) {
                alert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }
            
            alert('â³ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙØªØ§Ø­ API...');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: 'Ù‚Ù„ Ù…Ø±Ø­Ø¨Ø§'
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 10
                        }
                    })
                });
                
                if (response.ok) {
                    alert('âœ… Ù…ÙØªØ§Ø­ API ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!');
                } else {
                    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…ÙØªØ§Ø­ API - ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…ÙØªØ§Ø­');
                }
                
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
            }
        }

        // Ø­Ø°Ù Ù…ÙØªØ§Ø­ API
        function clearApiKey() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù…ÙØªØ§Ø­ API Ø§Ù„Ù…Ø­ÙÙˆØ¸ØŸ')) {
                // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
                apiKeyGlobal = null;
                
                // Ø­Ø°Ù Ù…Ù† localStorage
                try {
                    localStorage.removeItem('gemini_api_key');
                } catch (e) {
                    console.warn('Could not remove from localStorage:', e);
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                const apiKeyInput = document.getElementById('api-key');
                apiKeyInput.placeholder = 'Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù…ÙØªØ§Ø­ API Ù‡Ù†Ø§...';
                apiKeyInput.style.borderColor = '#e9ecef';
                
                alert('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        // ÙØ­Øµ Ø­Ø§Ù„Ø© Ù…ÙØªØ§Ø­ API
        function checkApiKeyStatus() {
            console.log('=== API Key Status Check ===');
            console.log('apiKeyGlobal:', apiKeyGlobal ? 'EXISTS' : 'NULL');
            console.log('localStorage:', localStorage.getItem('gemini_api_key') ? 'EXISTS' : 'NULL');
            
            const apiKey = getApiKey();
            
            if (!apiKey) {
                alert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸\n\nØ­Ø§Ù„Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ:\n- Ù…ØªØºÙŠØ± Ø¹Ø§Ù…: ' + (apiKeyGlobal ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ÙØ§Ø±Øº') + '\n- localStorage: ' + (localStorage.getItem('gemini_api_key') ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ÙØ§Ø±Øº'));
                return;
            }
            
            let message = `âœ… ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸\n`;
            message += `Ø§Ù„Ø·ÙˆÙ„: ${apiKey.length} Ø­Ø±Ù\n`;
            message += `Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ${apiKey.substring(0, 10)}...\n`;
            message += `Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: ...${apiKey.substring(apiKey.length - 5)}`;
            
            if (apiKey.startsWith('AIza')) {
                message += '\n\nâœ… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ ØµØ­ÙŠØ­';
            } else {
                message += '\n\nâš ï¸ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø®Ø§Ø·Ø¦';
            }
            
            alert(message);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© API
        function showApiStatus(message, type) {
            const statusDiv = document.getElementById('api-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = message;
            
            switch(type) {
                case 'success':
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.color = '#155724';
                    break;
                case 'error':
                    statusDiv.style.background = '#f8d7da';
                    statusDiv.style.color = '#721c24';
                    break;
                case 'warning':
                    statusDiv.style.background = '#fff3cd';
                    statusDiv.style.color = '#856404';
                    break;
                case 'info':
                    statusDiv.style.background = '#d1ecf1';
                    statusDiv.style.color = '#0c5460';
                    break;
            }
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ
        function showDebugInfo(info) {
            const debugDiv = document.getElementById('debug-info');
            const debugContent = document.getElementById('debug-content');
            
            debugContent.innerHTML = `
                <br>â€¢ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØªØ§Ø­: ${info.hasKey ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}
                <br>â€¢ Ø·ÙˆÙ„ Ø§Ù„Ù…ÙØªØ§Ø­: ${info.keyLength || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                <br>â€¢ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ÙØªØ§Ø­: ${info.keyStart || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                <br>â€¢ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${info.connectionStatus || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                <br>â€¢ Ø¢Ø®Ø± Ø®Ø·Ø£: ${info.lastError || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
            `;
            
            debugDiv.style.display = 'block';
            
            setTimeout(() => {
                debugDiv.style.display = 'none';
            }, 10000);
        }

        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­
        function togglePasswordVisibility() {
            const apiKeyInput = document.getElementById('api-key');
            const toggleButton = event.target;
            
            if (apiKeyInput.type === 'password') {
                apiKeyInput.type = 'text';
                toggleButton.textContent = 'ğŸ™ˆ';
                toggleButton.title = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­';
            } else {
                apiKeyInput.type = 'password';
                toggleButton.textContent = 'ğŸ‘ï¸';
                toggleButton.title = 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙØªØ§Ø­';
            }
        }

        // Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©
        async function pasteApiKey() {
            try {
                const text = await navigator.clipboard.readText();
                const apiKeyInput = document.getElementById('api-key');
                apiKeyInput.value = text.trim();
                
                if (text.trim()) {
                    alert('âœ… ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­! Ù„Ø§ ØªÙ†Ø³ Ø­ÙØ¸Ù‡');
                    // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ù„ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                    apiKeyInput.focus();
                } else {
                    alert('âš ï¸ Ø§Ù„Ø­Ø§ÙØ¸Ø© ÙØ§Ø±ØºØ©');
                }
            } catch (err) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù„ØµÙ‚:', err);
                alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø§ÙØ¸Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ctrl+V Ù„Ù„ØµÙ‚');
            }
        }



        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            console.log('Page loaded');
            console.log('API key ready: ' + (apiKeyGlobal ? 'YES' : 'NO'));
            
            // ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            initializeEventHandlers();
        }

        // ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function initializeEventHandlers() {
            const apiKeyInput = document.getElementById('api-key');
            
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙ‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ctrl+V
            apiKeyInput.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'v') {
                    setTimeout(() => {
                        if (this.value.trim()) {
                            showApiStatus('ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­! Ù„Ø§ ØªÙ†Ø³ Ø­ÙØ¸Ù‡ ğŸ’¾', 'success');
                        }
                    }, 100);
                }
            });

            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙ‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù†
            apiKeyInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    if (this.value.trim()) {
                        showApiStatus('ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­! Ù„Ø§ ØªÙ†Ø³ Ø­ÙØ¸Ù‡ ğŸ’¾', 'success');
                    }
                }, 100);
            });

            // Ø¹Ø±Ø¶ Ù†ØµØ§Ø¦Ø­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ù„
            apiKeyInput.addEventListener('focus', function() {
                if (!this.value.trim()) {
                    showApiStatus('ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± ğŸ“‹ Ø£Ùˆ Ctrl+V', 'info');
                }
            });

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
            apiKeyInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    const statusDiv = document.getElementById('api-status');
                    statusDiv.style.display = 'none';
                }
            });
        }

        function switchTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            document.getElementById('result-container').classList.remove('show');
        }

        function createAcademicPrompt(title, field, level, pageCount, additionalReq) {
            return `
Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ØŒ Ø£Ø±ÙŠØ¯ Ù…Ù†Ùƒ ÙƒØªØ§Ø¨Ø© Ø¨Ø­Ø« Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø´Ø§Ù…Ù„ ÙˆÙ…ÙØµÙ„ Ø¨Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:

**Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«:** ${title}
**Ù…Ø¬Ø§Ù„ Ø§Ù„ØªØ®ØµØµ:** ${field}
**Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ:** ${level}
**Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª:** ${pageCount}
**Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:** ${additionalReq || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}

ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ù‡Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨Ø­Ø«:

1. **Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ:**
   - Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù‡Ø±Ù…ÙŠ: Ù…Ø¨Ø­Ø« â†’ Ù…Ø·Ù„Ø¨ â†’ ÙØ±Ø¹
   - Ø±Ù‚Ù… ÙƒÙ„ Ø¹Ù†ØµØ± Ø¨ÙˆØ¶ÙˆØ­
   - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙˆØ§Ø¶Ø­Ø© ÙˆØ§Ù„Ù…Ø­Ø¯Ø¯Ø©

2. **Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ù„Ù…ÙŠ:**
   - Ø§ÙƒØªØ¨ Ù…Ù‚Ø¯Ù…Ø© Ø´Ø§Ù…Ù„Ø© ØªØªØ¶Ù…Ù† Ø§Ù„Ø¥Ø´ÙƒØ§Ù„ÙŠØ© ÙˆØ£Ù‡Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
   - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ù…ØµØ·Ù„Ø­Ø§Øª
   - Ø§Ø°ÙƒØ± Ø¢Ø±Ø§Ø¡ Ù…ØªÙ†ÙˆØ¹Ø© Ù„Ù„ÙÙ‚Ù‡Ø§Ø¡ ÙˆØ§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†
   - Ù‚Ø¯Ù… Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ© ÙˆØªØ·Ø¨ÙŠÙ‚ÙŠØ©
   - Ø§Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚

3. **Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ ÙˆØ§Ù„Ù‡ÙˆØ§Ù…Ø´:**
   - Ø§ÙƒØªØ¨ Ù‡ÙˆØ§Ù…Ø´ Ù…Ø±Ù‚Ù…Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ ÙÙ‚Ø±Ø© Ù…Ù‡Ù…Ø©
   - Ø§Ø³ØªØ®Ø¯Ù… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ
   - Ø£Ø¶Ù Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ø§Ø¬Ø¹ Ø´Ø§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©

4. **Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ${level}:**
   ${level === 'Ø³Ù†Ø©-Ø£ÙˆÙ„Ù‰' ? '- Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø¨Ø³Ø·Ø©\n- Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©\n- Ø£Ø¶Ù Ø´Ø±ÙˆØ­Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ØµØ·Ù„Ø­Ø§Øª' : 
     level === 'Ø³Ù†Ø©-Ø«Ø§Ù†ÙŠØ©' ? '- Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©\n- Ø§Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚\n- Ø£Ø¶Ù Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©' :
     level === 'Ø³Ù†Ø©-Ø«Ø§Ù„Ø«Ø©' ? '- Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©\n- Ù‚Ù… Ø¨ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ù…Ù‚ Ù„Ù„Ù‚Ø¶Ø§ÙŠØ§\n- Ø§Ø°ÙƒØ± Ø¢Ø±Ø§Ø¡ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„Ù‚Ø¶Ø§Ø¡' :
     level === 'Ù…Ø§Ø³ØªØ±' ? '- Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙ‚Ø¯Ù… ÙˆØ¯Ù‚ÙŠÙ‚\n- ØªØ­Ù„ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ Ù„Ù„Ø¢Ø±Ø§Ø¡\n- Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø®ØªÙ„ÙØ©\n- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø±Ø§Ø¬Ø¹ Ù…ØªØ®ØµØµØ©' :
     '- Ù…Ø³ØªÙˆÙ‰ Ø¨Ø­Ø«ÙŠ Ø¹Ø§Ù„ÙŠ\n- ØªØ­Ù„ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ Ø¹Ù…ÙŠÙ‚\n- Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©\n- Ù…Ø±Ø§Ø¬Ø¹ Ø­Ø¯ÙŠØ«Ø© ÙˆÙ…ØªØ®ØµØµØ©'}

5. **Ø§Ù„ØªÙ†Ø³ÙŠÙ‚:**
   - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„ÙØ±Ø¹ÙŠØ©
   - Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù†Øµ Ù…Ù‚Ø³Ù…Ø§Ù‹ Ø¥Ù„Ù‰ ÙÙ‚Ø±Ø§Øª Ù…Ù†Ø·Ù‚ÙŠØ©
   - Ø§ÙƒØªØ¨ Ø®Ø§ØªÙ…Ø© ØªÙ„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª

Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ø­ØªØ±ÙØ© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.
            `;
        }

        async function callGeminiAPI(prompt) {
            const apiKey = getApiKey();
            console.log('Calling Gemini API, key exists:', !!apiKey);
            if (!apiKey || apiKey.trim() === '') {
                throw new Error('ğŸ”‘ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø³Ù… Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©.\n\nØ¥Ø°Ø§ ÙƒÙ†Øª Ù‚Ø¯ Ø£Ø¯Ø®Ù„ØªÙ‡ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø¬Ø±Ø¨:\n1. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©\n2. Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙØªØ§Ø­\n3. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©');
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 8192,
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    let errorMessage = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    console.error('API Error Details:', {
                        status: response.status,
                        statusText: response.statusText,
                        errorData: errorData
                    });
                    
                    if (response.status === 400) {
                        if (errorData.error?.message?.includes('API key')) {
                            errorMessage = 'Ù…ÙØªØ§Ø­ API ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…ÙØ¹Ù„';
                        } else {
                            errorMessage = 'Ø·Ù„Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­ - ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØªØ§Ø­ API';
                        }
                    } else if (response.status === 403) {
                        errorMessage = 'Ù…ÙØªØ§Ø­ API ØºÙŠØ± Ù…ÙØ¹Ù„ Ø£Ùˆ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Gemini';
                    } else if (response.status === 429) {
                        errorMessage = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
                    } else if (response.status === 500) {
                        errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                    }
                    
                    throw new Error(`âŒ ${errorMessage} (${response.status})\n${errorData.error?.message || ''}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØµØ§Ù„Ø­Ø© Ù…Ù† API');
                }

                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('ğŸŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ');
                }
                throw error;
            }
        }

        async function generateAcademicResearch() {
            console.log('Starting research generation...');
            
            // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØªØ§Ø­ Ø£ÙˆÙ„Ø§Ù‹
            const apiKey = getApiKey();
            
            console.log('API Key check:', {
                apiKeyGlobal: apiKeyGlobal ? 'EXISTS' : 'NULL',
                localStorage: localStorage.getItem('gemini_api_key') ? 'EXISTS' : 'NULL',
                finalKey: apiKey ? 'EXISTS' : 'NULL'
            });
            
            if (!apiKey) {
                alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ API!\n\nÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø£Ø¹Ù„Ø§Ù‡ ÙˆØ­ÙØ¸Ù‡ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const title = document.getElementById('research-title').value;
            const field = document.getElementById('research-field').value;
            const level = document.getElementById('research-level').value;
            const pageCount = document.getElementById('page-count').value;
            const additionalReq = document.getElementById('additional-requirements').value;

            if (!title.trim()) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«');
                return;
            }

            if (!field) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¨Ø­Ø«');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = document.querySelector('.generate-btn');

            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ...</div>
                    <div style="font-size: 14px; margin-top: 10px;">Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¹Ø¯Ø© Ø¯Ù‚Ø§Ø¦Ù‚</div>
                </div>
            `;
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';

            try {
                const prompt = createAcademicPrompt(title, field, level, pageCount, additionalReq);
                const result = await callGeminiAPI(prompt);
                
                const formattedResult = formatAcademicResult(result, level);
                resultDiv.innerHTML = formattedResult;
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«</h4>
                        <p>${error.message}</p>
                        <p>ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…ÙØªØ§Ø­ API ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ';
            }
        }

        function formatAcademicResult(text, level) {
            const levelNames = {
                'Ø³Ù†Ø©-Ø£ÙˆÙ„Ù‰': 'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø­Ù‚ÙˆÙ‚',
                'Ø³Ù†Ø©-Ø«Ø§Ù†ÙŠØ©': 'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø­Ù‚ÙˆÙ‚', 
                'Ø³Ù†Ø©-Ø«Ø§Ù„Ø«Ø©': 'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø­Ù‚ÙˆÙ‚',
                'Ù…Ø§Ø³ØªØ±': 'Ø§Ù„Ù…Ø§Ø³ØªØ±',
                'Ø¯ÙƒØªÙˆØ±Ø§Ù‡': 'Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø§Ù‡'
            };
            
            return `
                <div class="highlight-box">
                    <h4>ğŸ“ Ø¨Ø­Ø« Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ - ${levelNames[level]}</h4>
                    <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                </div>
                <div style="text-align: justify; line-height: 1.8; font-family: 'Times New Roman', serif;">
                    ${text.replace(/\n/g, '<br>')}
                </div>
            `;
        }

        function createSummaryPrompt(subject, length, level, content) {
            return `
Ø£Ù†Øª Ø£Ø³ØªØ§Ø° Ù…ØªØ®ØµØµ ÙÙŠ ${subject}. Ø£Ø±ÙŠØ¯ Ù…Ù†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ„Ø®ÙŠØµ Ø´Ø§Ù…Ù„ ÙˆÙ…ÙÙŠØ¯ Ø¨Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:

**Ø§Ù„Ù…Ø§Ø¯Ø©:** ${subject}
**Ø·ÙˆÙ„ Ø§Ù„ØªÙ„Ø®ÙŠØµ:** ${length}
**Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ„Ø®ÙŠØµ:** ${level}
**Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ„Ø®ÙŠØµÙ‡:** ${content}

**ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ„Ø®ÙŠØµ:**

1. **Ø§Ù„ØªÙ†Ø¸ÙŠÙ…:**
   - Ø§Ù‚Ø³Ù… Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø¥Ù„Ù‰ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆÙØ±Ø¹ÙŠØ©
   - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
   - Ø±Ù‚Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ù‡Ù…Ø©

2. **Ø§Ù„Ù…Ø­ØªÙˆÙ‰:**
   - Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø©
   - Ø§Ø°ÙƒØ± Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
   - Ø£Ø¶Ù Ø£Ù…Ø«Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
   - Ø§Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ù…Ø®ØªÙ„ÙØ©

**Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ„Ø®ÙŠØµ ${level}:**
${level === 'Ù…Ø¨Ø³Ø·' ? '- Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØ§Ø¶Ø­Ø©\n- ØªØ¬Ù†Ø¨ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©\n- Ø£Ø¶Ù Ø´Ø±ÙˆØ­Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©' : 
  level === 'Ù…ØªÙˆØ³Ø·' ? '- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©\n- ØªÙØµÙŠÙ„ Ù…ØªÙˆØ§Ø²Ù†\n- Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…' : 
  '- Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©\n- ØªØ­Ù„ÙŠÙ„ Ø¹Ù…ÙŠÙ‚\n- Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª'}

Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ø³Ù‚Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„ÙÙ‡Ù….
            `;
        }

        async function generateSummary() {
            const subject = document.getElementById('subject-select').value;
            const length = document.getElementById('summary-length').value;
            const level = document.getElementById('summary-level').value;
            const content = document.getElementById('lesson-content').value;

            if (!subject) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø©');
                return;
            }

            if (!content.trim()) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ„Ø®ÙŠØµÙ‡');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;

            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ø®ÙŠØµ...</div>
                </div>
            `;

            generateBtn.disabled = true;
            generateBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';

            try {
                const prompt = createSummaryPrompt(subject, length, level, content);
                const result = await callGeminiAPI(prompt);

                const formattedResult = formatSummaryResult(result, subject, length);
                resultDiv.innerHTML = formattedResult;

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ø®ÙŠØµ:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ø®ÙŠØµ</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ø®ÙŠØµ';
            }
        }

        function formatSummaryResult(text, subject, length) {
            const lengthNames = {
                'Ù‚ØµÙŠØ±': 'ØªÙ„Ø®ÙŠØµ Ù‚ØµÙŠØ±',
                'Ù…ØªÙˆØ³Ø·': 'ØªÙ„Ø®ÙŠØµ Ù…ØªÙˆØ³Ø·',
                'Ù…ÙØµÙ„': 'ØªÙ„Ø®ÙŠØµ Ù…ÙØµÙ„'
            };
            
            return `
                <div class="highlight-box">
                    <h4>ğŸ“š ${lengthNames[length]} - ${subject}</h4>
                    <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø¨Ù†Ø¬Ø§Ø­ - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…ÙˆØ¶ÙˆØ¹</p>
                </div>
                <div style="text-align: justify; line-height: 1.8; font-family: 'Times New Roman', serif;">
                    ${text.replace(/\n/g, '<br>')}
                </div>
            `;
        }

        function createPreparationPrompt(title, field, prepType) {
            let specificInstructions = '';
            
            switch(prepType) {
                case 'Ø®Ø·Ø©':
                    specificInstructions = `
**Ø§ÙƒØªØ¨ Ø®Ø·Ø© Ø¨Ø­Ø« Ù…ÙØµÙ„Ø© ØªØªØ¶Ù…Ù†:**
1. Ù…Ù‚Ø¯Ù…Ø© Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
2. Ø¥Ø´ÙƒØ§Ù„ÙŠØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
3. Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡
4. Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ù…ØªØ¨Ø¹Ø©
5. Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù‚ØªØ±Ø­ (Ù…Ø¨Ø§Ø­Ø«ØŒ Ù…Ø·Ø§Ù„Ø¨ØŒ ÙØ±ÙˆØ¹)
6. Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
7. Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ø¥Ù†Ø¬Ø§Ø²
                    `;
                    break;
                case 'Ù…Ø±Ø§Ø¬Ø¹':
                    specificInstructions = `
**Ø§ÙƒØªØ¨ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ø§Ø¬Ø¹ Ø´Ø§Ù…Ù„Ø© ØªØªØ¶Ù…Ù†:**
1. Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
2. Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…ØªØ®ØµØµØ©
3. Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©
4. Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©
5. Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©
6. Ø§Ù„Ø§Ø¬ØªÙ‡Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ù‡Ù…Ø©
7. Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø§Ù„Ù…ÙÙŠØ¯Ø©
                    `;
                    break;
                case 'Ø£Ø³Ø¦Ù„Ø©':
                    specificInstructions = `
**Ø§ÙƒØªØ¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:**
1. Ø£Ø³Ø¦Ù„Ø© Ø­ÙˆÙ„ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
2. Ø£Ø³Ø¦Ù„Ø© ØªØ­Ù„ÙŠÙ„ÙŠØ© Ù…Ø¹Ù…Ù‚Ø©
3. Ø£Ø³Ø¦Ù„Ø© Ù…Ù‚Ø§Ø±Ù†Ø©
4. Ø£Ø³Ø¦Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ÙŠØ© (Ø­Ø§Ù„Ø§Øª Ø¹Ù…Ù„ÙŠØ©)
5. Ø£Ø³Ø¦Ù„Ø© Ù†Ù‚Ø¯ÙŠØ©
6. Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
7. Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                    `;
                    break;
                case 'Ø´Ø§Ù…Ù„':
                    specificInstructions = `
**Ø§ÙƒØªØ¨ ØªØ­Ø¶ÙŠØ±Ø§Ù‹ Ø´Ø§Ù…Ù„Ø§Ù‹ ÙŠØªØ¶Ù…Ù†:**
1. Ø®Ø·Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØµÙ„Ø©
2. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
3. Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
4. Ù…Ù„Ø®Øµ Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
5. Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… ÙˆØ§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
6. Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø¨Ø­Ø«
7. Ù†ØµØ§Ø¦Ø­ ÙˆÙ…Ù‚ØªØ±Ø­Ø§Øª Ù„Ù„ÙƒØªØ§Ø¨Ø©
                    `;
                    break;
            }

            return `
Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙÙŠ ${field}. Ø£Ø±ÙŠØ¯ Ù…Ù†Ùƒ Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø¨Ø­Ø« Ø§Ù„ØªØ§Ù„ÙŠ:

**Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«:** ${title}
**Ø§Ù„Ù…Ø¬Ø§Ù„:** ${field}
**Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ±:** ${prepType}

${specificInstructions}

**Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¹Ø§Ù…Ø©:**
- Ø§ÙƒØªØ¨ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù†Ø¸Ù…Ø©
- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
- Ù‚Ø¯Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙÙŠØ¯Ø© ÙˆØ¹Ù…Ù„ÙŠØ©
- Ø±ØªØ¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ø·Ù‚ÙŠØ©
- Ø£Ø¶Ù Ù†ØµØ§Ø¦Ø­ Ù…ÙÙŠØ¯Ø© Ù„Ù„Ø¨Ø§Ø­Ø«

Ø§ÙƒØªØ¨ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙ…ÙÙŠØ¯Ø©.
            `;
        }

        async function generatePreparation() {
            const title = document.getElementById('prep-title').value;
            const field = document.getElementById('prep-field').value;
            const prepType = document.getElementById('prep-type').value;

            if (!title.trim()) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«');
                return;
            }

            if (!field) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¨Ø­Ø«');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;

            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</div>
                </div>
            `;

            generateBtn.disabled = true;
            generateBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';

            try {
                const prompt = createPreparationPrompt(title, field, prepType);
                const result = await callGeminiAPI(prompt);

                const formattedResult = formatPreparationResult(result, prepType);
                resultDiv.innerHTML = formattedResult;

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ğŸ“‹ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±';
            }
        }

        function formatPreparationResult(text, prepType) {
            const title = prepType === 'Ø®Ø·Ø©' ? 'ğŸ“‹ Ø®Ø·Ø© Ø§Ù„Ø¨Ø­Ø«' : 
                         prepType === 'Ù…Ø±Ø§Ø¬Ø¹' ? 'ğŸ“š Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹' :
                         prepType === 'Ø£Ø³Ø¦Ù„Ø©' ? 'â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©' : 'ğŸ“‹ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„';
            
            return `
                <div class="highlight-box">
                    <h4>${title}</h4>
                    <p>ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…ÙˆØ¶ÙˆØ¹</p>
                </div>
                <div style="text-align: justify; line-height: 1.8; font-family: 'Times New Roman', serif;">
                    ${text.replace(/\n/g, '<br>')}
                </div>
            `;
        }

        function resetForm() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ
            document.getElementById('research-title').value = '';
            document.getElementById('research-field').value = '';
            document.getElementById('research-level').value = '';
            document.getElementById('page-count').value = '';
            document.getElementById('additional-requirements').value = '';
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ„Ø®ÙŠØµ
            document.getElementById('subject-select').value = '';
            document.getElementById('summary-length').value = '';
            document.getElementById('summary-level').value = '';
            document.getElementById('lesson-content').value = '';
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­Ø¶ÙŠØ±
            document.getElementById('prep-title').value = '';
            document.getElementById('prep-field').value = '';
            document.getElementById('prep-type').value = 'Ø®Ø·Ø©';
        }

        function copyResult() {
            const resultText = document.getElementById('result').innerText;
            navigator.clipboard.writeText(resultText).then(() => {
                alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            }).catch(err => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®: ', err);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®');
            });
        }

        function downloadResult() {
            const resultText = document.getElementById('result').innerText;
            const title = document.getElementById('research-title').value || 'Ø§Ù„Ø¨Ø­Ø«';
            
            const blob = new Blob([resultText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${title}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function printResult() {
            const resultContent = document.getElementById('result').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø­Ø«</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; direction: rtl; }
                        .highlight-box { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
                    </style>
                </head>
                <body>
                    ${resultContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
    </script>
</body>
</html>