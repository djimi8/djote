<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูููุฏ ุงูุฃุจุญุงุซ ุงูุฃูุงุฏูููุฉ ุงูุฐูู</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
            margin: 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            border-radius: 10px 10px 0 0;
            margin-left: 2px;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-group textarea {
            height: 120px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }
        
        .generate-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-container {
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 1px solid #dee2e6;
            display: none;
        }
        
        .result-container.show {
            display: block;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .result-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.5em;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .copy-btn {
            background: #17a2b8;
            color: white;
        }
        
        .copy-btn:hover {
            background: #138496;
        }
        
        .download-btn {
            background: #28a745;
            color: white;
        }
        
        .download-btn:hover {
            background: #218838;
        }
        
        .print-btn {
            background: #ffc107;
            color: #212529;
        }
        
        .print-btn:hover {
            background: #e0a800;
        }
        
        #result {
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #3498db;
            font-size: 18px;
        }
        
        .loading .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        
        .feature {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .feature h4 {
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .feature p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* ุฃููุงุท ุฅุถุงููุฉ ูููููุฒุงุช ุงูุฌุฏูุฏุฉ */
        .audio-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .audio-controls button {
            margin: 5px;
            flex: 1;
            min-width: 120px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .progress-text {
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .quiz-timer {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .quiz-question {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #ecf0f1;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .quiz-question h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .quiz-options {
            margin: 15px 0;
        }
        
        .quiz-option {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quiz-option:hover {
            background: #e9ecef;
        }
        
        .quiz-option input {
            margin-left: 10px;
            transform: scale(1.2);
        }
        
        .quiz-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .quiz-result {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .quiz-result.fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .legal-template {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .legal-template h4 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .legal-template ul {
            margin: 10px 0;
            padding-right: 20px;
        }
        
        .legal-template li {
            margin: 8px 0;
            color: #6c757d;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .highlight-box h4 {
            margin: 0 0 10px 0;
            font-size: 1.3em;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #ecf0f1;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            flex: 0 0 auto;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            border-radius: 10px 10px 0 0;
            margin-left: 2px;
            white-space: nowrap;
            min-width: 140px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-left: 0;
                margin-bottom: 2px;
                min-width: auto;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .audio-controls {
                flex-direction: column;
            }
            
            .audio-controls button {
                min-width: auto;
            }
            
            .quiz-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .quiz-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>โ๏ธ ูุณุงุนุฏ ุทูุจุฉ ุงูุญููู ุงูุฐูู</h1>
            <p>ูุธุงู ุดุงูู ููุณุงุนุฏุฉ ุทูุจุฉ ุงูุญููู ูู ุงูุฏุฑุงุณุฉ ูุงูุจุญุซ ูุงูุชุญุถูุฑ</p>
            
            <!-- ุฎูุงุฑ ุงุฎุชูุงุฑ ุงููููุฐุฌ -->
            <div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px;">
                <label style="font-weight: bold; color: #495057; margin-bottom: 5px; display: block;">๐ค ุงุฎุชูุงุฑ ูููุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู:</label>
                <select id="ai-model-select" style="width: 300px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; background: white;">
                    <option value="gemini-2.0-flash">โก Gemini 2.0 Flash (ุงูุฃุณุฑุน - ูุฌุงูู)</option>
                    <option value="gemini-1.5-flash">๐ฅ Gemini 1.5 Flash (ูุชูุงุฒู - ูุฌุงูู)</option>
                    <option value="deepseek-chat" disabled>๐ง DeepSeek Chat (ูุฑูุจุงู)</option>
                    <option value="deepseek-coder" disabled>๐ป DeepSeek Coder (ูุฑูุจุงู)</option>
                </select>
                <small style="color: #6c757d; display: block; margin-top: 5px;">ูู ูููุฐุฌ ูู ููุงุท ููุฉ ูุฎุชููุฉ ูู ูุชุงุจุฉ ุงูุฃุจุญุงุซ ุงููุงููููุฉ</small>
            </div>
            
            <div style="margin-top: 10px;">
                <button onclick="resetSystem()" style="background: #e74c3c; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    ๐ง ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
                </button>
                <button onclick="checkSystemStatus()" style="background: #3498db; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                    ๐ ุญุงูุฉ ุงููุธุงู
                </button>
                <button onclick="showModelInfo()" style="background: #17a2b8; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                    โน๏ธ ูุนูููุงุช ุงูููุงุฐุฌ
                </button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('research')">๐ ูุชุงุจุฉ ุจุญุซ ูุงูููู</button>
            <button class="tab" onclick="switchTab('summary')">๐ ุชูุฎูุต ุงูุฏุฑูุณ</button>
            <button class="tab" onclick="switchTab('preparation')">๐ ุชุญุถูุฑ ุงูุจุญุซ</button>
        </div>

        <div id="research-tab" class="tab-content active">
            <div class="form-row">
                <div class="form-group">
                    <label>ุนููุงู ุงูุจุญุซ</label>
                    <input type="text" id="research-title" placeholder="ูุซุงู: ููููู ุงููุงููู ูุฎุตุงุฆุตู">
                </div>
                <div class="form-group">
                    <label>ูุฌุงู ุงูุจุญุซ</label>
                    <select id="research-field">
                        <option value="">ุงุฎุชุฑ ูุฑุน ุงููุงููู</option>
                        <option value="ูุงููู ูุฏูู">ุงููุงููู ุงููุฏูู</option>
                        <option value="ูุงููู ุฌูุงุฆู">ุงููุงููู ุงูุฌูุงุฆู</option>
                        <option value="ูุงููู ุฅุฏุงุฑู">ุงููุงููู ุงูุฅุฏุงุฑู</option>
                        <option value="ูุงููู ุชุฌุงุฑู">ุงููุงููู ุงูุชุฌุงุฑู</option>
                        <option value="ูุงููู ุฏุณุชูุฑู">ุงููุงููู ุงูุฏุณุชูุฑู</option>
                        <option value="ูุงููู ุฏููู">ุงููุงููู ุงูุฏููู</option>
                        <option value="ูุงููู ุนูู">ูุงููู ุงูุนูู</option>
                        <option value="ูุงููู ุฃุณุฑุฉ">ูุงููู ุงูุฃุณุฑุฉ</option>
                        <option value="ูุงููู ูุงูู">ุงููุงููู ุงููุงูู</option>
                        <option value="ูุงููู ุนูุงุฑู">ุงููุงููู ุงูุนูุงุฑู</option>
                        <option value="ูุงููู ุจุญุฑู">ุงููุงููู ุงูุจุญุฑู</option>
                        <option value="ูุงููู ุฌูู">ุงููุงููู ุงูุฌูู</option>
                        <option value="ูุงููู ุจูุฆุฉ">ูุงููู ุงูุจูุฆุฉ</option>
                        <option value="ูุงููู ูุนูููุงุชูุฉ">ูุงููู ุงููุนูููุงุชูุฉ</option>
                        <option value="ูุงููู ุถุฑูุจู">ุงููุงููู ุงูุถุฑูุจู</option>
                        <option value="ูุงููู ุชุฃููู">ูุงููู ุงูุชุฃููู</option>
                        <option value="ูุงููู ุฅุฌุฑุงุกุงุช ูุฏููุฉ">ูุงููู ุงูุฅุฌุฑุงุกุงุช ุงููุฏููุฉ</option>
                        <option value="ูุงููู ุฅุฌุฑุงุกุงุช ุฌุฒุงุฆูุฉ">ูุงููู ุงูุฅุฌุฑุงุกุงุช ุงูุฌุฒุงุฆูุฉ</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>ุงููุณุชูู ุงูุฃูุงุฏููู</label>
                    <select id="research-level">
                        <option value="ุณูุฉ-ุฃููู">ุงูุณูุฉ ุงูุฃููู ุญููู</option>
                        <option value="ุณูุฉ-ุซุงููุฉ">ุงูุณูุฉ ุงูุซุงููุฉ ุญููู</option>
                        <option value="ุณูุฉ-ุซุงูุซุฉ">ุงูุณูุฉ ุงูุซุงูุซุฉ ุญููู</option>
                        <option value="ูุงุณุชุฑ">ุงููุงุณุชุฑ</option>
                        <option value="ุฏูุชูุฑุงู">ุงูุฏูุชูุฑุงู</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ุนุฏุฏ ุงูุตูุญุงุช ุงููุทููุจ</label>
                    <select id="page-count">
                        <option value="ูุตูุฑ">ูุตูุฑ (5-8 ุตูุญุงุช)</option>
                        <option value="ูุชูุณุท">ูุชูุณุท (10-15 ุตูุญุฉ)</option>
                        <option value="ุทููู">ุทููู (20-25 ุตูุญุฉ)</option>
                        <option value="ููุตู">ููุตู (30+ ุตูุญุฉ)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>ูุชุทูุจุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)</label>
                <textarea id="additional-requirements" placeholder="ูุซุงู: ุงูุชุฑููุฒ ุนูู ุงููุงููู ุงูุฌุฒุงุฆุฑูุ ุงุณุชุฎุฏุงู ูุฑุงุฌุน ุญุฏูุซุฉุ ุชุทุจูู ุนูู ุญุงูุงุช ุนูููุฉ..."></textarea>
            </div>

            <div class="action-buttons">
                <button class="generate-btn" onclick="generateAcademicResearch()">
                    ๐ ุฅูุดุงุก ุงูุจุญุซ ุงูุฃูุงุฏููู
                </button>
                <button class="generate-btn" onclick="resetForm()" style="background: #95a5a6; margin-right: 10px;">
                    ๐ ุฅุนุงุฏุฉ ุชุนููู
                </button>
            </div>
        </div>

        <!-- ุชุจููุจ ุชูุฎูุต ุงูุฏุฑูุณ -->
        <div id="summary-tab" class="tab-content">
            <div class="form-group">
                <label>ุงุฎุชุฑ ุงููุงุฏุฉ ุงููุงููููุฉ</label>
                <select id="subject-select">
                    <option value="">ุงุฎุชุฑ ุงููุงุฏุฉ</option>
                    <option value="ูุฏุฎู ููุนููู ุงููุงููููุฉ">ูุฏุฎู ููุนููู ุงููุงููููุฉ</option>
                    <option value="ุงููุงููู ุงููุฏูู">ุงููุงููู ุงููุฏูู</option>
                    <option value="ุงููุงููู ุงูุฌูุงุฆู">ุงููุงููู ุงูุฌูุงุฆู</option>
                    <option value="ุงููุงููู ุงูุฅุฏุงุฑู">ุงููุงููู ุงูุฅุฏุงุฑู</option>
                    <option value="ุงููุงููู ุงูุชุฌุงุฑู">ุงููุงููู ุงูุชุฌุงุฑู</option>
                    <option value="ุงููุงููู ุงูุฏุณุชูุฑู">ุงููุงููู ุงูุฏุณุชูุฑู</option>
                    <option value="ูุงููู ุงูุฃุณุฑุฉ">ูุงููู ุงูุฃุณุฑุฉ</option>
                    <option value="ูุงููู ุงูุนูู">ูุงููู ุงูุนูู</option>
                </select>
            </div>
            <div class="form-group">
                <label>ุงูุฏุฑุณ ุฃู ุงููุญุงุถุฑุฉ ุงููุฑุงุฏ ุชูุฎูุตูุง</label>
                <textarea id="lesson-content" placeholder="ุงูุตู ููุง ูุญุชูู ุงูุฏุฑุณ ุฃู ุงููุญุงุถุฑุฉ ุงูุชู ุชุฑูุฏ ุชูุฎูุตูุง..."></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ููุน ุงูุชูุฎูุต</label>
                    <select id="summary-type">
                        <option value="ุดุงูู">ุชูุฎูุต ุดุงูู</option>
                        <option value="ููุงุท">ุงูููุงุท ุงูุฑุฆูุณูุฉ ููุท</option>
                        <option value="ุชุนุฑููุงุช">ุงูุชุนุฑููุงุช ูุงูููุงููู</option>
                        <option value="ุฃูุซูุฉ">ุงูุฃูุซูุฉ ูุงูุชุทุจููุงุช</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ูุณุชูู ุงูุชูุฎูุต</label>
                    <select id="summary-level">
                        <option value="ูุจุณุท">ูุจุณุท ูููุจุชุฏุฆูู</option>
                        <option value="ูุชูุณุท">ูุชูุณุท</option>
                        <option value="ูุชูุฏู">ูุชูุฏู ููุงูุชุญุงูุงุช</option>
                    </select>
                </div>
            </div>
            <button class="generate-btn" onclick="generateSummary()">
                ๐ ุฅูุดุงุก ุงูุชูุฎูุต
            </button>
        </div>

        <!-- ุชุจููุจ ุชุญุถูุฑ ุงูุจุญุซ -->
        <div id="preparation-tab" class="tab-content">
            <div class="form-group">
                <label>ุนููุงู ุงูุจุญุซ ุงููุฑุงุฏ ุงูุชุญุถูุฑ ูู</label>
                <input type="text" id="prep-title" placeholder="ูุซุงู: ุงูุนูุฏ ูู ุงููุงููู ุงููุฏูู ุงูุฌุฒุงุฆุฑู">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ูุฑุน ุงููุงููู</label>
                    <select id="prep-field">
                        <option value="">ุงุฎุชุฑ ุงููุฑุน</option>
                        <option value="ูุงููู ูุฏูู">ุงููุงููู ุงููุฏูู</option>
                        <option value="ูุงููู ุฌูุงุฆู">ุงููุงููู ุงูุฌูุงุฆู</option>
                        <option value="ูุงููู ุฅุฏุงุฑู">ุงููุงููู ุงูุฅุฏุงุฑู</option>
                        <option value="ูุงููู ุชุฌุงุฑู">ุงููุงููู ุงูุชุฌุงุฑู</option>
                        <option value="ูุงููู ุฏุณุชูุฑู">ุงููุงููู ุงูุฏุณุชูุฑู</option>
                        <option value="ูุงููู ุนูู">ูุงููู ุงูุนูู</option>
                        <option value="ูุงููู ุฃุณุฑุฉ">ูุงููู ุงูุฃุณุฑุฉ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ููุน ุงูุชุญุถูุฑ</label>
                    <select id="prep-type">
                        <option value="ุฎุทุฉ">ุฎุทุฉ ุงูุจุญุซ ููุท</option>
                        <option value="ูุฑุงุฌุน">ูุงุฆูุฉ ุงููุฑุงุฌุน</option>
                        <option value="ุฃุณุฆูุฉ">ุงูุฃุณุฆูุฉ ุงููุญุชููุฉ</option>
                        <option value="ุดุงูู">ุชุญุถูุฑ ุดุงูู</option>
                    </select>
                </div>
            </div>
            <button class="generate-btn" onclick="generatePreparation()">
                ๐ ุฅูุดุงุก ุงูุชุญุถูุฑ
            </button>
        </div>





        <div id="result-container" class="result-container">
            <div class="result-header">
                <h3>ูุชูุฌุฉ ุงูุจุญุซ</h3>
                <div class="action-buttons">
                    <button class="action-btn copy-btn" onclick="copyResult()">๐ ูุณุฎ</button>
                    <button class="action-btn download-btn" onclick="downloadResult()">๐ฅ ุชุญููู</button>
                    <button class="action-btn print-btn" onclick="printResult()">๐จ๏ธ ุทุจุงุนุฉ</button>
                </div>
            </div>
            <div id="result"></div>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">๐ฏ</div>
                <h4>ุจุญุซ ูุชุฎุตุต</h4>
                <p>ูุชู ุฅูุดุงุก ุงูุจุญุซ ุญุณุจ ุงููุฌุงู ุงูุฃูุงุฏููู ุงููุญุฏุฏ</p>
            </div>
            <div class="feature">
                <div class="feature-icon">๐</div>
                <h4>ูุฑุงุฌุน ููุซููุฉ</h4>
                <p>ุงุณุชุฎุฏุงู ูุตุงุฏุฑ ุนูููุฉ ููุฑุงุฌุน ุฃูุงุฏูููุฉ ูุนุชูุฏุฉ</p>
            </div>
            <div class="feature">
                <div class="feature-icon">โก</div>
                <h4>ุฅูุชุงุฌ ุณุฑูุน</h4>
                <p>ุฅูุดุงุก ุจุญุซ ุดุงูู ูู ุฏูุงุฆู ูุนุฏูุฏุฉ</p>
            </div>
            <div class="feature">
                <div class="feature-icon">โจ</div>
                <h4>ุฌูุฏุฉ ุนุงููุฉ</h4>
                <p>ูุญุชูู ุฃูุงุฏููู ุงุญุชุฑุงูู ูููุณู</p>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'research';

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to selected tab
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // ุฅุฎูุงุก ุงููุชุงุฆุฌ ูุฅุนุงุฏุฉ ุชุนููู ุงูุญุงูุฉ ุนูุฏ ุชุบููุฑ ุงูุชุจููุจ
            const resultContainer = document.getElementById('result-container');
            if (resultContainer) {
                resultContainer.classList.remove('show');
            }
            
            // ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุงุฎุชุจุงุฑ ูุงููุฑุงุกุฉ
            resetAppState();
        }
        
        // ุฏุงูุฉ ูุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุชุทุจูู
        function resetAppState() {
            // ุฅููุงู ุงููุฑุงุกุฉ ุฅู ูุงูุช ุชุนูู
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
            }
            
            // ุฅููุงู ูุคูุช ุงูุงุฎุชุจุงุฑ
            if (quizTimer) {
                clearInterval(quizTimer);
                quizTimer = null;
            }
            
            // ุฅุนุงุฏุฉ ุชุนููู ุงูุงุฎุชุจุงุฑ
            currentQuiz = null;
            const quizContainer = document.getElementById('quiz-container');
            if (quizContainer) {
                quizContainer.style.display = 'none';
            }
            
            // ุฅุฎูุงุก ุดุฑูุท ุชูุฏู ุงููุฑุงุกุฉ
            const readingProgress = document.getElementById('reading-progress');
            if (readingProgress) {
                readingProgress.style.display = 'none';
            }
            
            // ุฅุนุงุฏุฉ ุชุนููู ูุคูุช ุงูุงุฎุชุจุงุฑ
            const timerElement = document.getElementById('timer');
            if (timerElement) {
                timerElement.textContent = '00:00';
            }
        }

        async function generateAcademicResearch() {
            const title = document.getElementById('research-title').value;
            const field = document.getElementById('research-field').value;
            const level = document.getElementById('research-level').value;
            const pageCount = document.getElementById('page-count').value;
            const additionalReq = document.getElementById('additional-requirements').value;
            
            if (!title.trim()) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนููุงู ุงูุจุญุซ');
                return;
            }
            
            if (!field) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุฌุงู ุงูุจุญุซ');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;
            
            // Show loading
            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ุฌุงุฑู ุฅูุดุงุก ุงูุจุญุซ ุงูุฃูุงุฏููู...</div>
                    <div style="font-size: 14px; margin-top: 10px;">ูุฏ ุชุณุชุบุฑู ูุฐู ุงูุนูููุฉ ุนุฏุฉ ุฏูุงุฆู</div>
                </div>
            `;
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'ุฌุงุฑู ุงูุฅูุดุงุก...';

            try {
                const prompt = createAcademicPrompt(title, field, level, pageCount, additionalReq);
                
                // ุงูุญุตูู ุนูู ุงููููุฐุฌ ุงููุญุฏุฏ
                let selectedModel = document.getElementById('ai-model-select').value;
                
                // ุชุญููู DeepSeek ุฅูู Gemini ูุคูุชุงู
                if (selectedModel.includes('deepseek')) {
                    selectedModel = 'gemini-2.0-flash';
                    document.getElementById('ai-model-select').value = selectedModel;
                    alert('โ๏ธ ููุงุฐุฌ DeepSeek ุบูุฑ ูุชููุฑุฉ ุญุงููุงู. ุชู ุงูุชุจุฏูู ุฅูู Gemini 2.0 Flash.');
                }
                
                const response = await fetch('http://localhost:3000/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        prompt: prompt,
                        type: 'academic',
                        selectedModel: selectedModel
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`ุฎุทุฃ ูู ุงูุดุจูุฉ: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                resultDiv.innerHTML = formatAcademicResult(data.research);
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุจุญุซ:', error);
                
                let errorHTML = '';
                try {
                    const errorData = JSON.parse(error.message);
                    errorHTML = `
                        <div class="error">
                            <h4>โ๏ธ ${errorData.type || 'ุฎุทุฃ ูู ุฅูุดุงุก ุงูุจุญุซ'}</h4>
                            <p><strong>ุงููุดููุฉ:</strong> ${errorData.message}</p>
                            ${errorData.suggestion ? `<p><strong>ุงูุญู ุงูููุชุฑุญ:</strong> ${errorData.suggestion}</p>` : ''}
                            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                                <h5>๐ก ูุตุงุฆุญ ููุญู:</h5>
                                <ul style="text-align: right; margin: 10px 0;">
                                    <li>ุชุฃูุฏ ูู ุงุชุตุงูู ุจุงูุฅูุชุฑูุช</li>
                                    <li>ุชุญูู ูู ุตุญุฉ ุนููุงู ุงูุจุญุซ</li>
                                    <li>ุงุฎุชุฑ ูุฑุน ุงููุงููู ุงูููุงุณุจ</li>
                                    <li>ุญุงูู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุฏูููุฉ</li>
                                </ul>
                            </div>
                        </div>
                    `;
                } catch (parseError) {
                    errorHTML = `
                        <div class="error">
                            <h4>โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูุจุญุซ</h4>
                            <p><strong>ุชูุงุตูู ุงูุฎุทุฃ:</strong> ${error.message}</p>
                            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                                <h5>๐ก ุญููู ููุชุฑุญุฉ:</h5>
                                <ul style="text-align: right; margin: 10px 0;">
                                    <li>๐ ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ ูุญุงูู ูุฑุฉ ุฃุฎุฑู</li>
                                    <li>โฐ ุงูุชุธุฑ ุฏูููุฉ ูุจู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู</li>
                                    <li>๐ ุชุฃูุฏ ูู ูุชุงุจุฉ ุนููุงู ุงูุจุญุซ ุจูุถูุญ</li>
                                    <li>๐ฏ ุงุฎุชุฑ ูุฑุน ุงููุงููู ุงูููุงุณุจ</li>
                                    <li>๐พ ุงุญูุธ ุนููู ูุจู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู</li>
                                </ul>
                                <div style="margin-top: 10px; padding: 8px; background: #d1ecf1; border-radius: 4px;">
                                    <small><strong>ููุงุญุธุฉ:</strong> ุฅุฐุง ุงุณุชูุฑ ุงูุฎุทุฃุ ููุฏ ูููู ููุงู ุถุบุท ุนูู ุงูุฎุงุฏู. ุงูุฑุฌุงุก ุงููุญุงููุฉ ุจุนุฏ 5 ุฏูุงุฆู.</small>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = errorHTML;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '๐ ุฅูุดุงุก ุงูุจุญุซ ุงูุฃูุงุฏููู';
            }
        }
        
        // ุฏุงูุฉ ูุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
        function resetForm() {
            // ุฅุนุงุฏุฉ ุชุนููู ูููุฐุฌ ุงูุจุญุซ ุงูุฃูุงุฏููู
            document.getElementById('research-title').value = '';
            document.getElementById('research-field').value = '';
            document.getElementById('research-level').value = '';
            document.getElementById('research-length').value = '';
            document.getElementById('additional-requirements').value = '';
            
            // ุฅุนุงุฏุฉ ุชุนููู ูููุฐุฌ ุงูุชูุฎูุต
            document.getElementById('subject-select').value = '';
            document.getElementById('lesson-content').value = '';
            document.getElementById('summary-type').value = 'ุดุงูู';
            document.getElementById('summary-level').value = 'ูุชูุณุท';
            
            // ุฅุนุงุฏุฉ ุชุนููู ูููุฐุฌ ุงูุชุญุถูุฑ
            document.getElementById('prep-title').value = '';
            document.getElementById('prep-field').value = '';
            document.getElementById('prep-type').value = 'ุฎุทุฉ';
            
            // ุฅุนุงุฏุฉ ุชุนููู ูููุฐุฌ ุงููุฑุงุกุฉ
            document.getElementById('text-to-read').value = '';
            document.getElementById('reading-speed').value = '1';
            document.getElementById('voice-type').value = 'male';
            
            // ุฅุนุงุฏุฉ ุชุนููู ูููุฐุฌ ุงูุงุฎุชุจุงุฑ
            document.getElementById('quiz-subject').value = '';
            document.getElementById('quiz-difficulty').value = 'ุณูู';
            document.getElementById('quiz-count').value = '5';
            document.getElementById('quiz-type').value = 'ุงุฎุชูุงุฑ ูุชุนุฏุฏ';
            document.getElementById('quiz-topic').value = '';
            
            // ุฅุฎูุงุก ุงููุชุงุฆุฌ
            const resultContainer = document.getElementById('result-container');
            if (resultContainer) {
                resultContainer.classList.remove('show');
            }
        }
        
        // ุฏุงูุฉ ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
        async function resetSystem() {
            try {
                const response = await fetch('/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                alert('โ ุชู ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู ุจูุฌุงุญ!\nููููู ุงูุขู ุฅุฌุฑุงุก ุจุญูุซ ุฌุฏูุฏุฉ.');
                
                // ุฅุนุงุฏุฉ ุชุนููู ูุงูู ููุตูุญุฉ
                resetForm();
                resetAppState();
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู:', error);
                alert('โ ูุดู ูู ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู. ุญุงูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ.');
            }
        }
        
        // ุฏุงูุฉ ูุญุต ุญุงูุฉ ุงููุธุงู
        async function checkSystemStatus() {
            try {
                const response = await fetch('/status');
                const status = await response.json();
                
                let keyStatsText = '';
                if (status.apiKeys && status.apiKeys.stats) {
                    keyStatsText = '\n๐ ุญุงูุฉ ููุงุชูุญ API:\n';
                    status.apiKeys.stats.forEach(key => {
                        const statusIcon = key.isActive ? 'โ' : 'โ';
                        keyStatsText += `โข ${key.name} (${key.type}): ${statusIcon}\n`;
                        keyStatsText += `  - ุงุณุชุฎุฏุงู: ${key.usageCount} ูุฑุฉ\n`;
                        keyStatsText += `  - ุฃุฎุทุงุก: ${key.failureCount}\n`;
                        keyStatsText += `  - ุงูููุชุงุญ: ...${key.keyEnd}\n`;
                    });
                    keyStatsText += `โข ุงูููุชุงุญ ุงูุญุงูู: ุฑูู ${status.apiKeys.current}\n`;
                }
                
                const statusMessage = `
๐ ุญุงูุฉ ุงููุธุงู:
โข ุนุฏุฏ ุงูุทูุจุงุช ุงูุญุงูู: ${status.requestCount}
โข ุงูุญุฏ ุงูุฃูุตู: ${status.maxRequests}
โข ุขุฎุฑ ุฅุนุงุฏุฉ ุชุนููู: ${status.lastReset}
โข ููุช ุงูุชุดุบูู: ${status.uptime} ุซุงููุฉ
โข ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ: ${Math.round(status.memory.used / 1024 / 1024)} ููุฌุงุจุงูุช
${keyStatsText}
                `;
                
                alert(statusMessage);
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ูุญุต ุงูุญุงูุฉ:', error);
                alert('โ ูุดู ูู ูุญุต ุญุงูุฉ ุงููุธุงู.');
            }
        }
        
        // ุฏุงูุฉ ุฅุธูุงุฑ ูุนูููุงุช ุงูููุงุฐุฌ
        function showModelInfo() {
            const modelInfo = `
๐ค ูุนูููุงุช ููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุฌุงููุฉ:

โก Gemini 2.0 Flash (ูุฌุงูู):
โข ุงูุฃุญุฏุซ ูุงูุฃุณุฑุน ูู Google
โข ูุชุฎุตุต ูู ุงููุญุชูู ุงูุฃูุงุฏููู
โข ุฏูุฉ ุนุงููุฉ ูู ุงููุตุทูุญุงุช ุงููุงููููุฉ
โข ููุงุณุจ ููุฃุจุญุงุซ ุงููุตูุฑุฉ ูุงููุชูุณุทุฉ
โข ุญุฏ 1500 ุทูุจ/ููู

๐ฅ Gemini 1.5 Flash (ูุฌุงูู):
โข ูุชูุงุฒู ุจูู ุงูุณุฑุนุฉ ูุงูุฌูุฏุฉ
โข ุฃุฏุงุก ููุชุงุฒ ูู ุงูุชุญููู ุงููุงูููู
โข ูุฏุนู ุงููุฑุงุฌุน ูุงูููุงูุด ุจุฏูุฉ
โข ููุงุณุจ ูุฌููุน ุฃููุงุน ุงูุฃุจุญุงุซ
โข ุญุฏ 1500 ุทูุจ/ููู

๐ง DeepSeek Chat (ูุฌุงูู):
โข ูููุฐุฌ ูุชูุฏู ูููุตูุต ุงููุนูุฏุฉ
โข ููุชุงุฒ ูู ุงูุชุญููู ุงููุนูู
โข ุฏูุฉ ุนุงููุฉ ูู ุงูุตูุงุบุฉ ุงูุฃูุงุฏูููุฉ
โข ููุงุณุจ ููุฃุจุญุงุซ ุงูุทูููุฉ ูุงููุนูุฏุฉ
โข ุงุณุชุฎุฏุงู ูุฌุงูู ุจุฏูู ุญุฏูุฏ

๐ป DeepSeek Coder (ูุฌุงูู):
โข ูุชุฎุตุต ูู ุงููุตูุต ุงูุชูููุฉ
โข ุฏูุฉ ุนุงููุฉ ูู ุงูุชูุณูู ูุงูููููุฉ
โข ููุชุงุฒ ููุฃุจุญุงุซ ุงูููุธูุฉ
โข ููุงุณุจ ูููุฑุงุฌุน ูุงูุฌุฏุงูู

๐ก ูุตุงุฆุญ ุงูุงุฎุชูุงุฑ:
โข ููุณุฑุนุฉ: Gemini 2.0 Flash
โข ููุชูุงุฒู: Gemini 1.5 Flash  
โข ููุฏูุฉ ุงูุนุงููุฉ: DeepSeek Chat
โข ููุชูุณูู ุงููุชูู: DeepSeek Coder

๐ ุฌููุน ุงูููุงุฐุฌ ูุฌุงููุฉ 100%!
            `;
            
            alert(modelInfo);
        }

        async function performSimpleResearch() {
            const query = document.getElementById('simple-query').value;
            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;
            
            if (!query.trim()) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุณุคุงู ุงูุจุญุซ');
                return;
            }
            
            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ุฌุงุฑู ุงูุจุญุซ...</div>
                </div>
            `;
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'ุฌุงุฑู ุงูุจุญุซ...';

            try {
                const response = await fetch('http://localhost:3000/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: query })
                });
                
                if (!response.ok) {
                    throw new Error(`ุฎุทุฃ ูู ุงูุดุจูุฉ: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                resultDiv.innerHTML = formatSimpleResult(data.research);
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุงูุจุญุซ:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุจุญุซ</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '๐ ุฅุฌุฑุงุก ุงูุจุญุซ';
            }
        }

        // ูุชุบูุฑุงุช ุนุงูุฉ ูููููุฒุงุช ุงูุฌุฏูุฏุฉ
        let currentSpeech = null;
        let quizTimer = null;
        let quizStartTime = 0;
        let currentQuiz = null;

        function createAcademicPrompt(title, field, level, pageCount, additionalReq) {
            return `
ุฃูุช ุฎุจูุฑ ูุงูููู ูุชุฎุตุต ูู ูุชุงุจุฉ ุงูุฃุจุญุงุซ ุงููุงููููุฉ ููุทูุจุฉ ุงูุฌุงูุนููู. ุฃุฑูุฏ ููู ูุชุงุจุฉ ุจุญุซ ูุงูููู ุดุงูู ูููุตู ุจุงูููุงุตูุงุช ุงูุชุงููุฉ:

**ุนููุงู ุงูุจุญุซ:** ${title}
**ูุฑุน ุงููุงููู:** ${field}
**ุงููุณุชูู ุงูุฃูุงุฏููู:** ${level}
**ุงูุทูู ุงููุทููุจ:** ${pageCount}
**ูุชุทูุจุงุช ุฅุถุงููุฉ:** ${additionalReq || 'ูุง ุชูุฌุฏ'}

**ูุฌุจ ุฃู ูุชุจุน ุงูุจุญุซ ุงููููุฐุฌ ุงููุงูููู ุงูุชุงูู ุจุฏูุฉ:**

**๐ ุงููููู ุงูุฅุฌุจุงุฑู ููุจุญุซ ุงููุงูููู:**

1. **ุตูุญุฉ ุงูุนููุงู:**
   - ุนููุงู ุงูุจุญุซ
   - ุงุณู ุงูุทุงูุจ: [ุงุณู ุงูุทุงูุจ]
   - ุงูุฃุณุชุงุฐ ุงููุดุฑู: [ุงุณู ุงูุฃุณุชุงุฐ]
   - ุงูุฌุงูุนุฉ: [ุงุณู ุงูุฌุงูุนุฉ]
   - ูููุฉ ุงูุญููู ูุงูุนููู ุงูุณูุงุณูุฉ
   - ุงูุณูุฉ ุงูุฌุงูุนูุฉ: 2024-2025

2. **ุงูููุฑุณ (ุฌุฏูู ุงููุญุชููุงุช):**
   - ุชุฑููู ุฏููู ูุฌููุน ุงูุนูุงููู ูุงูุตูุญุงุช

3. **ุงูููุฏูุฉ:**
   - ุชูููุฏ ููููุถูุน
   - ุฅุดูุงููุฉ ุงูุจุญุซ (ุณุคุงู ุฑุฆูุณู)
   - ุฃูููุฉ ุงูููุถูุน
   - ุฃูุฏุงู ุงูุจุญุซ
   - ูููุฌูุฉ ุงูุจุญุซ (ูุตูู ุชุญูููู ููุงุฑู)
   - ุฎุทุฉ ุงูุจุญุซ

4. **ุงููุจุงุญุซ ุงูุฑุฆูุณูุฉ (2-3 ูุจุงุญุซ):**
   - ุงููุจุญุซ ุงูุฃูู: [ุนููุงู ูุชุนูู ุจุงูููุงููู ูุงูุชุนุฑููุงุช]
     - ุงููุทูุจ ุงูุฃูู: [ุชุนุฑูู ุงูููููู ุงูุฃุณุงุณู]
       - ุงููุฑุน ุงูุฃูู: [ุงูุชุนุฑูู ุงููุบูู ูุงูุงุตุทูุงุญู]
       - ุงููุฑุน ุงูุซุงูู: [ุงูุชุนุฑูู ุงููููู ูุงููุถุงุฆู]
     - ุงููุทูุจ ุงูุซุงูู: [ุฎุตุงุฆุต ุฃู ุฃุฑูุงู ุฃู ุดุฑูุท]
       - ุงููุฑุน ุงูุฃูู: [ุงูุฎุตุงุฆุต ุงูุฃุณุงุณูุฉ]
       - ุงููุฑุน ุงูุซุงูู: [ุงูุฎุตุงุฆุต ุงูุซุงูููุฉ]

   - ุงููุจุญุซ ุงูุซุงูู: [ุงูุฃุญูุงู ูุงูุชุทุจููุงุช]
     - ุงููุทูุจ ุงูุฃูู: [ุงูุฃุญูุงู ุงูุนุงูุฉ]
       - ุงููุฑุน ุงูุฃูู: [ูู ุงูุชุดุฑูุน]
       - ุงููุฑุน ุงูุซุงูู: [ูู ุงูููู ูุงููุถุงุก]
     - ุงููุทูุจ ุงูุซุงูู: [ุงูุชุทุจููุงุช ุงูุนูููุฉ]
       - ุงููุฑุน ุงูุฃูู: [ูู ุงููุงููู ุงูุฌุฒุงุฆุฑู]
       - ุงููุฑุน ุงูุซุงูู: [ูู ุงูููุงููู ุงูููุงุฑูุฉ]

5. **ุงูุฎุงุชูุฉ:**
   - ุชูุฎูุต ุฃูู ุงููุชุงุฆุฌ
   - ุงูุชูุตูุงุช ูุงูุงูุชุฑุงุญุงุช
   - ุขูุงู ุงูุจุญุซ ุงููุณุชูุจููุฉ

6. **ูุงุฆูุฉ ุงููุฑุงุฌุน ูุงููุตุงุฏุฑ:**
   - ุงููุชุจ (ุนุฑุจูุฉ ูุฃุฌูุจูุฉ)
   - ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ
   - ุงูููุงูุงุช ุงูุนูููุฉ
   - ุงููุตูุต ุงููุงููููุฉ
   - ุงูุฃุญูุงู ุงููุถุงุฆูุฉ
   - ุงูููุงูุน ุงูุฅููุชุฑูููุฉ

**โ๏ธ ุงููุชุทูุจุงุช ุงููุงููููุฉ ุงูุฎุงุตุฉ:**

1. **ุงููุตุทูุญุงุช ุงููุงููููุฉ:**
   - ุงุณุชุฎุฏู ุงููุตุทูุญุงุช ุงููุงููููุฉ ุงูุฏูููุฉ
   - ุนุฑูู ูู ูุตุทูุญ ุนูุฏ ุฐูุฑู ูุฃูู ูุฑุฉ
   - ุงุณุชุฎุฏู ุงููุตุทูุญุงุช ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุงููุฑูุณูุฉ ุนูุฏ ุงูุถุฑูุฑุฉ

2. **ุงููุฑุงุฌุน ุงููุงููููุฉ:**
   - ุงุฐูุฑ ุงููุตูุต ุงููุงููููุฉ ุจุฏูุฉ (ุฑูู ุงููุงุฏุฉุ ุงููุงูููุ ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ)
   - ุฃุดุฑ ููุฃุญูุงู ุงููุถุงุฆูุฉ (ุงููุญููุฉุ ุฑูู ุงููุฑุงุฑุ ุงูุชุงุฑูุฎ)
   - ุงุณุชุฎุฏู ูุฑุงุฌุน ูุงููููุฉ ููุซููุฉ ููุญุฏุซุฉ

3. **ุงูุฃุณููุจ ุงููุงูููู:**
   - ุงุณุชุฎุฏู ุงูุชุนุจูุฑุงุช ุงููุงููููุฉ ุงูููุงุณุจุฉ
   - ุชุฌูุจ ุงูุขุฑุงุก ุงูุดุฎุตูุฉ
   - ุงุนุชูุฏ ุนูู ุงูุฃุฏูุฉ ุงููุงููููุฉ ูุงูููููุฉ
   - ุงุณุชุฎุฏู ุฃุณููุจ ุงูุชุญููู ูุงูููุงุฑูุฉ

4. **ุงูููุงูุด ุงููุงููููุฉ:**
   - ุฑูู ุงูููุงูุด ุจุชุณูุณู
   - ุงูุชุจ ุงููุฑุฌุน ูุงููุงู ูู ุงููุงูุด ุงูุฃูู
   - ุงุณุชุฎุฏู ุงุฎุชุตุงุฑุงุช ูููุฑุงุฌุน ุงููุชูุฑุฑุฉ

**๐ฏ ูุซุงู ุนูู ุงููุฑุงุฌุน ุงููุงููููุฉ:**
(1) ุฏ. ุนุจุฏ ุงูุฑุฒุงู ุงูุณูููุฑูุ ุงููุณูุท ูู ุดุฑุญ ุงููุงููู ุงููุฏููุ ุงูุฌุฒุก ุงูุฃููุ ูุธุฑูุฉ ุงูุงูุชุฒุงู ุจูุฌู ุนุงูุ ุฏุงุฑ ุงูููุถุฉ ุงูุนุฑุจูุฉุ ุงููุงูุฑุฉุ 2019ุ ุต 45.
(2) ุงููุงููู ุงููุฏูู ุงูุฌุฒุงุฆุฑูุ ุงูุฃูุฑ ุฑูู 75-58 ุงููุคุฑุฎ ูู 26 ุณุจุชูุจุฑ 1975ุ ุงููุนุฏู ูุงููุชููุ ุงูุฌุฑูุฏุฉ ุงูุฑุณููุฉ ุฑูู 78.
(3) ูุฑุงุฑ ุงููุญููุฉ ุงูุนููุงุ ุงูุบุฑูุฉ ุงููุฏููุฉุ ุฑูู 123456ุ ุงููุคุฑุฎ ูู 15/03/2023.

**ุงูุฑุฌุงุก ูุชุงุจุฉ ุงูุจุญุซ ูุงููุงู ูุน ุงูุชุฑููุฒ ุนูู ุงููููุฌูุฉ ุงููุงููููุฉ ูุงูุฃูุงุฏูููุฉ ุงููุทููุจุฉ ูุทูุจุฉ ุงูุญููู.**
            `;
        }

        // ุฏุงูุฉ ุชูุฎูุต ุงูุฏุฑูุณ
        async function generateSummary() {
            const subject = document.getElementById('subject-select').value;
            const content = document.getElementById('lesson-content').value;
            const summaryType = document.getElementById('summary-type').value;
            const summaryLevel = document.getElementById('summary-level').value;

            if (!subject) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงููุงุฏุฉ ุงููุงููููุฉ');
                return;
            }

            if (!content.trim()) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุญุชูู ุงูุฏุฑุณ');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;

            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ุฌุงุฑู ุชูุฎูุต ุงูุฏุฑุณ...</div>
                </div>
            `;

            generateBtn.disabled = true;
            generateBtn.textContent = 'ุฌุงุฑู ุงูุชูุฎูุต...';

            try {
                const prompt = createSummaryPrompt(subject, content, summaryType, summaryLevel);
                
                const response = await fetch('http://localhost:3000/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        prompt: prompt,
                        type: 'summary'
                    })
                });

                if (!response.ok) {
                    throw new Error(`ุฎุทุฃ ูู ุงูุดุจูุฉ: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                resultDiv.innerHTML = formatSummaryResult(data.research);

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุงูุชูุฎูุต:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูุฎูุต ุงูุฏุฑุณ</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '๐ ุฅูุดุงุก ุงูุชูุฎูุต';
            }
        }

        function createSummaryPrompt(subject, content, summaryType, summaryLevel) {
            return `
ุฃูุช ุฃุณุชุงุฐ ูุงููู ูุชุฎุตุต ูู ุงููุงุฏุฉ: ${subject}

ุงููุทููุจ: ุชูุฎูุต ุงููุญุชูู ุงูุชุงูู ุจุทุฑููุฉ ${summaryType} ููุณุชูู ${summaryLevel}

**ุงููุญุชูู ุงููุฑุงุฏ ุชูุฎูุตู:**
${content}

**ูุชุทูุจุงุช ุงูุชูุฎูุต:**

1. **ุฅุฐุง ูุงู ุงูุชูุฎูุต ุดุงูู:**
   - ุงูุชุจ ุชูุฎูุตุงู ูุบุทู ุฌููุน ุงูููุงุท ุงููููุฉ
   - ุงุณุชุฎุฏู ุชุฑูููุงู ูุงุถุญุงู
   - ุฃุถู ุงูุชุนุฑููุงุช ุงูุฃุณุงุณูุฉ

2. **ุฅุฐุง ูุงู ุงูููุงุท ุงูุฑุฆูุณูุฉ ููุท:**
   - ุงูุชุจ ุงูููุงุท ุงููููุฉ ูู ุดูู ูุงุฆูุฉ
   - ูู ููุทุฉ ูู ุณุทุฑ ูููุตู
   - ุฑูุฒ ุนูู ุงูุฃุณุงุณูุงุช

3. **ุฅุฐุง ูุงู ุงูุชุนุฑููุงุช ูุงูููุงููู:**
   - ุงุณุชุฎุฑุฌ ุฌููุน ุงูุชุนุฑููุงุช ูู ุงููุต
   - ุงูุชุจ ูู ุชุนุฑูู ุจูุถูุญ
   - ุฃุถู ุงููุตุทูุญุงุช ุงููุงููููุฉ

4. **ุฅุฐุง ูุงู ุงูุฃูุซูุฉ ูุงูุชุทุจููุงุช:**
   - ุงุณุชุฎุฑุฌ ุงูุฃูุซูุฉ ุงูุนูููุฉ
   - ุงุดุฑุญ ุงูุชุทุจููุงุช ุงููุงููููุฉ
   - ุฃุถู ุญุงูุงุช ุนูููุฉ ุฅุถุงููุฉ

**ูุณุชูู ุงูุชูุฎูุต ${summaryLevel}:**
${summaryLevel === 'ูุจุณุท' ? '- ุงุณุชุฎุฏู ูุบุฉ ุจุณูุทุฉ ููุงุถุญุฉ\n- ุชุฌูุจ ุงููุตุทูุญุงุช ุงููุนูุฏุฉ\n- ุฃุถู ุดุฑูุญุงุช ุฅุถุงููุฉ' : 
  summaryLevel === 'ูุชูุณุท' ? '- ุงุณุชุฎุฏู ุงููุตุทูุญุงุช ุงููุงููููุฉ ุงูููุงุณุจุฉ\n- ุชูุตูู ูุชูุงุฒู\n- ุฑุจุท ุจูู ุงูููุงููู' : 
  '- ุงุณุชุฎุฏู ูุตุทูุญุงุช ูุงููููุฉ ุฏูููุฉ\n- ุชุญููู ุนููู\n- ููุงุณุจ ููุงูุชุญุงูุงุช ูุงููุณุงุจูุงุช'}

ุงูุชุจ ุงูุชูุฎูุต ุจุทุฑููุฉ ููุณูุฉ ูุณููุฉ ุงูููู.
            `;
        }

        // ุฏุงูุฉ ุชุญุถูุฑ ุงูุจุญุซ
        async function generatePreparation() {
            const title = document.getElementById('prep-title').value;
            const field = document.getElementById('prep-field').value;
            const prepType = document.getElementById('prep-type').value;

            if (!title.trim()) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนููุงู ุงูุจุญุซ');
                return;
            }

            if (!field) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุฑุน ุงููุงููู');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;

            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ุฌุงุฑู ุฅุนุฏุงุฏ ุงูุชุญุถูุฑ...</div>
                </div>
            `;

            generateBtn.disabled = true;
            generateBtn.textContent = 'ุฌุงุฑู ุงูุชุญุถูุฑ...';

            try {
                const prompt = createPreparationPrompt(title, field, prepType);
                
                const response = await fetch('http://localhost:3000/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        prompt: prompt,
                        type: 'preparation'
                    })
                });

                if (!response.ok) {
                    throw new Error(`ุฎุทุฃ ูู ุงูุดุจูุฉ: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                resultDiv.innerHTML = formatPreparationResult(data.research, prepType);

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุงูุชุญุถูุฑ:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุนุฏุงุฏ ุงูุชุญุถูุฑ</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '๐ ุฅูุดุงุก ุงูุชุญุถูุฑ';
            }
        }

        function createPreparationPrompt(title, field, prepType) {
            const basePrompt = `
ุฃูุช ุฎุจูุฑ ูุงูููู ูุชุฎุตุต ูู ${field}. 

ุนููุงู ุงูุจุญุซ: "${title}"
ููุน ุงูุชุญุถูุฑ ุงููุทููุจ: ${prepType}
            `;

            switch(prepType) {
                case 'ุฎุทุฉ':
                    return basePrompt + `
ุงููุทููุจ: ุฅุนุฏุงุฏ ุฎุทุฉ ุจุญุซ ููุตูุฉ ุชุชุถูู:

1. **ุงูููุฏูุฉ:**
   - ุชูููุฏ ููููุถูุน
   - ุฅุดูุงููุฉ ุงูุจุญุซ (ุณุคุงู ุฑุฆูุณู ูุงุถุญ)
   - ุฃูููุฉ ุงูููุถูุน
   - ุฃูุฏุงู ุงูุจุญุซ
   - ูููุฌูุฉ ุงูุจุญุซ
   - ุตุนูุจุงุช ุงูุจุญุซ
   - ุฎุทุฉ ุงูุจุญุซ

2. **ุงููุจุงุญุซ ุงูููุชุฑุญุฉ:**
   - ุงููุจุญุซ ุงูุฃูู: [ุงูุชุฑุญ ุนููุงูุงู ููุงุณุจุงู]
     - ุงููุทูุจ ุงูุฃูู: [ุนููุงู ูุฑุนู]
       - ุงููุฑุน ุงูุฃูู: [ุชูุตูู]
       - ุงููุฑุน ุงูุซุงูู: [ุชูุตูู]
     - ุงููุทูุจ ุงูุซุงูู: [ุนููุงู ูุฑุนู]
       - ุงููุฑุน ุงูุฃูู: [ุชูุตูู]
       - ุงููุฑุน ุงูุซุงูู: [ุชูุตูู]
   
   - ุงููุจุญุซ ุงูุซุงูู: [ุงูุชุฑุญ ุนููุงูุงู ููุงุณุจุงู]
     [ููุณ ุงูุชูุณูู]

3. **ุงูุฎุงุชูุฉ ุงูููุชุฑุญุฉ:**
   - ุงููุชุงุฆุฌ ุงููุชููุนุฉ
   - ุงูุชูุตูุงุช ุงููุญุชููุฉ

ุงุฌุนู ุงูุฎุทุฉ ูุชูุงุฒูุฉ ูููุทููุฉ ูููุงุณุจุฉ ูุทูุจุฉ ${field}.
                    `;

                case 'ูุฑุงุฌุน':
                    return basePrompt + `
ุงููุทููุจ: ุฅุนุฏุงุฏ ูุงุฆูุฉ ูุฑุงุฌุน ุดุงููุฉ ููุญุฏุซุฉ ุชุชุถูู:

1. **ุงููุชุจ ุงูุฃุณุงุณูุฉ:** (10-15 ูุฑุฌุน)
   - ูุชุจ ุนุฑุจูุฉ ูุชุฎุตุตุฉ
   - ูุชุจ ูุชุฑุฌูุฉ ูููุฉ
   - ุฃุฏุฑุฌ ุงููุคููุ ุงูุนููุงูุ ุฏุงุฑ ุงููุดุฑุ ุงูุณูุฉ

2. **ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ:** (5-8 ุฑุณุงุฆู)
   - ุฑุณุงุฆู ูุงุฌุณุชูุฑ ูุฏูุชูุฑุงู ุญุฏูุซุฉ
   - ูู ุฌุงูุนุงุช ุนุฑุจูุฉ ูุฎุชููุฉ

3. **ุงูููุงูุงุช ุงูุนูููุฉ:** (8-12 ููุงู)
   - ููุงูุงุช ูู ูุฌูุงุช ูุงููููุฉ ูุญููุฉ
   - ููุงูุงุช ุญุฏูุซุฉ (ุขุฎุฑ 5 ุณููุงุช)

4. **ุงููุตูุต ุงููุงููููุฉ:**
   - ุงูููุงููู ุฐุงุช ุงูุตูุฉ
   - ุงููุฑุงุณูู ุงูุชูููุฐูุฉ
   - ุงููุฑุงุฑุงุช ุงููุฒุงุฑูุฉ

5. **ุงูุฃุญูุงู ุงููุถุงุฆูุฉ:**
   - ูุฑุงุฑุงุช ุงููุญููุฉ ุงูุนููุง
   - ูุฑุงุฑุงุช ูุฌูุณ ุงูุฏููุฉ
   - ุฃุญูุงู ูุญุงูู ุฃุฎุฑู ูููุฉ

6. **ุงูููุงูุน ุงูุฅููุชุฑูููุฉ ุงูููุซููุฉ:**
   - ููุงูุน ุฑุณููุฉ
   - ููุชุจุงุช ุฑูููุฉ
   - ูุฌูุงุช ุฅููุชุฑูููุฉ

ุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุฑุงุฌุน ุญุฏูุซุฉ ูููุซููุฉ ููุชููุนุฉ.
                    `;

                case 'ุฃุณุฆูุฉ':
                    return basePrompt + `
ุงููุทููุจ: ุฅุนุฏุงุฏ ูุฌููุนุฉ ุดุงููุฉ ูู ุงูุฃุณุฆูุฉ ุงููุญุชููุฉ ุญูู ุงูููุถูุน:

1. **ุฃุณุฆูุฉ ุงูุชุนุฑูู:** (5-7 ุฃุณุฆูุฉ)
   - ูุง ุงูููุตูุฏ ุจู...ุ
   - ุนุฑู...ุ
   - ุฃุฐูุฑ ุชุนุฑูู...ุ

2. **ุฃุณุฆูุฉ ุงูุดุฑุญ:** (5-7 ุฃุณุฆูุฉ)
   - ุงุดุฑุญ...ุ
   - ูุถุญ...ุ
   - ุจููู...ุ

3. **ุฃุณุฆูุฉ ุงูููุงุฑูุฉ:** (3-5 ุฃุณุฆูุฉ)
   - ูุงุฑู ุจูู... ู...ุ
   - ูุง ุงููุฑู ุจูู... ู...ุ
   - ููุฒ ุจูู... ู...ุ

4. **ุฃุณุฆูุฉ ุงูุชุญููู:** (3-5 ุฃุณุฆูุฉ)
   - ุญูู...ุ
   - ูุงูุด...ุ
   - ูุง ุฑุฃูู ูู...ุ

5. **ุฃุณุฆูุฉ ุงูุชุทุจูู:** (3-5 ุฃุณุฆูุฉ)
   - ุทุจู ุนูู ุญุงูุฉ ุนูููุฉ...ุ
   - ููู ูููู ุชุทุจูู... ูู...ุ

6. **ุฃุณุฆูุฉ ุงูุญุงูุงุช ุงูุนูููุฉ:** (2-3 ุญุงูุงุช)
   - ุญุงูุงุช ูุงููููุฉ ููุชุญููู ูุงูุญู

ุงุฌุนู ุงูุฃุณุฆูุฉ ูุชุฏุฑุฌุฉ ุงูุตุนูุจุฉ ูููุงุณุจุฉ ููุณุชูู ุงูุทูุจุฉ.
                    `;

                default: // ุดุงูู
                    return basePrompt + `
ุงููุทููุจ: ุฅุนุฏุงุฏ ุชุญุถูุฑ ุดุงูู ูุชุถูู:

1. **ุฎุทุฉ ุงูุจุญุซ ุงูููุตูุฉ**
2. **ูุงุฆูุฉ ุงููุฑุงุฌุน ุงูุฃุณุงุณูุฉ**
3. **ุงูุฃุณุฆูุฉ ุงููุญุชููุฉ**
4. **ุงูููุงุท ุงููููุฉ ููุชุฑููุฒ ุนูููุง**
5. **ุงููุตุทูุญุงุช ุงูุฃุณุงุณูุฉ ูุชุนุฑููุงุชูุง**
6. **ุงูุตุนูุจุงุช ุงููุชููุนุฉ ูููููุฉ ุชุฌุงูุฒูุง**
7. **ูุตุงุฆุญ ูููุชุงุจุฉ ูุงูุจุญุซ**

ุงุฌุนู ุงูุชุญุถูุฑ ุฏูููุงู ุดุงููุงู ููุทุงูุจ ูู ุงูุจุฏุงูุฉ ููููุงูุฉ.
                    `;
            }
        }

        function formatAcademicResult(text) {
            // Format the academic result with proper styling
            return `<div style="text-align: justify; font-family: 'Times New Roman', serif; line-height: 2; font-size: 16px;">${text.replace(/\n/g, '<br>')}</div>`;
        }

        function formatSimpleResult(text) {
            return `<div style="text-align: justify; line-height: 1.8;">${text.replace(/\n/g, '<br>')}</div>`;
        }

        function formatSummaryResult(text) {
            return `
                <div class="highlight-box">
                    <h4>๐ ุชูุฎูุต ุงูุฏุฑุณ</h4>
                    <p>ุชู ุฅูุดุงุก ุงูุชูุฎูุต ุจูุฌุงุญ - ููููู ุงูุขู ูุณุฎู ุฃู ุทุจุงุนุชู</p>
                </div>
                <div style="text-align: justify; line-height: 1.8; font-family: 'Times New Roman', serif;">
                    ${text.replace(/\n/g, '<br>')}
                </div>
            `;
        }

        function formatPreparationResult(text, prepType) {
            const title = prepType === 'ุฎุทุฉ' ? '๐ ุฎุทุฉ ุงูุจุญุซ' : 
                         prepType === 'ูุฑุงุฌุน' ? '๐ ูุงุฆูุฉ ุงููุฑุงุฌุน' :
                         prepType === 'ุฃุณุฆูุฉ' ? 'โ ุงูุฃุณุฆูุฉ ุงููุญุชููุฉ' : '๐ ุงูุชุญุถูุฑ ุงูุดุงูู';
            
            return `
                <div class="highlight-box">
                    <h4>${title}</h4>
                    <p>ุชู ุฅุนุฏุงุฏ ุงูุชุญุถูุฑ ุจูุฌุงุญ - ูุฑุงุฌุนุฉ ุดุงููุฉ ููููุถูุน</p>
                </div>
                <div style="text-align: justify; line-height: 1.8; font-family: 'Times New Roman', serif;">
                    ${text.replace(/\n/g, '<br>')}
                </div>
            `;
        }

        // ุฏูุงู ูุงุฑุฆ ุงููุตูุต
        function startReading() {
            const text = document.getElementById('text-to-read').value;
            const speed = parseFloat(document.getElementById('reading-speed').value);
            const voiceType = document.getElementById('voice-type').value;

            if (!text.trim()) {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงููุต ุงููุฑุงุฏ ูุฑุงุกุชู');
                return;
            }

            // ุฅููุงู ุงููุฑุงุกุฉ ุงูุญุงููุฉ ุฅู ูุฌุฏุช
            if (currentSpeech) {
                currentSpeech.cancel();
            }

            // ุงูุชุญูู ูู ุฏุนู ุงููุชุตูุญ
            if (!('speechSynthesis' in window)) {
                alert('ุงููุชุตูุญ ูุง ูุฏุนู ุฎุงุตูุฉ ุชุญููู ุงููุต ุฅูู ููุงู');
                return;
            }

            // ุฅูุดุงุก ูุงุฆู ุงูููุงู
            currentSpeech = new SpeechSynthesisUtterance(text);
            currentSpeech.rate = speed;
            currentSpeech.pitch = 1;
            currentSpeech.volume = 1;

            // ุงุฎุชูุงุฑ ุงูุตูุช
            const voices = speechSynthesis.getVoices();
            const arabicVoices = voices.filter(voice => voice.lang.includes('ar'));
            
            if (arabicVoices.length > 0) {
                currentSpeech.voice = arabicVoices[0];
            }

            // ุนุฑุถ ุดุฑูุท ุงูุชูุฏู
            const progressDiv = document.getElementById('reading-progress');
            progressDiv.style.display = 'block';

            // ุฃุญุฏุงุซ ุงููุฑุงุกุฉ
            currentSpeech.onstart = function() {
                updateReadingProgress(0);
            };

            currentSpeech.onboundary = function(event) {
                const progress = (event.charIndex / text.length) * 100;
                updateReadingProgress(progress);
            };

            currentSpeech.onend = function() {
                updateReadingProgress(100);
                setTimeout(() => {
                    progressDiv.style.display = 'none';
                }, 2000);
            };

            currentSpeech.onerror = function(event) {
                console.error('ุฎุทุฃ ูู ุงููุฑุงุกุฉ:', event.error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงููุฑุงุกุฉ');
                progressDiv.style.display = 'none';
            };

            // ุจุฏุก ุงููุฑุงุกุฉ
            speechSynthesis.speak(currentSpeech);
        }

        function pauseReading() {
            if (speechSynthesis.speaking && !speechSynthesis.paused) {
                speechSynthesis.pause();
            } else if (speechSynthesis.paused) {
                speechSynthesis.resume();
            }
        }

        function stopReading() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                document.getElementById('reading-progress').style.display = 'none';
            }
        }

        function updateReadingProgress(progress) {
            const progressFill = document.querySelector('.progress-fill');
            const progressText = document.querySelector('.progress-text');
            
            progressFill.style.width = progress + '%';
            progressText.textContent = `ุฌุงุฑู ุงููุฑุงุกุฉ... ${Math.round(progress)}%`;
        }

        // ุฏูุงู ุงูุงุฎุชุจุงุฑุงุช ุงูุฐููุฉ
        async function generateQuiz() {
            const subject = document.getElementById('quiz-subject').value;
            const difficulty = document.getElementById('quiz-difficulty').value;
            const count = document.getElementById('quiz-count').value;
            const type = document.getElementById('quiz-type').value;
            const topic = document.getElementById('quiz-topic').value;

            if (!subject) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงููุงุฏุฉ');
                return;
            }

            const resultContainer = document.getElementById('result-container');
            const resultDiv = document.getElementById('result');
            const generateBtn = event.target;

            resultContainer.classList.add('show');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ุฌุงุฑู ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ...</div>
                </div>
            `;

            generateBtn.disabled = true;
            generateBtn.textContent = 'ุฌุงุฑู ุงูุฅูุดุงุก...';

            try {
                const prompt = createQuizPrompt(subject, difficulty, count, type, topic);
                
                const response = await fetch('http://localhost:3000/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        prompt: prompt,
                        type: 'quiz'
                    })
                });

                if (!response.ok) {
                    throw new Error(`ุฎุทุฃ ูู ุงูุดุจูุฉ: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                currentQuiz = parseQuizData(data.research);
                displayQuiz(currentQuiz);
                startQuizTimer();

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'โ ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ';
            }
        }

        function createQuizPrompt(subject, difficulty, count, type, topic) {
            return `
ุฃูุช ุฃุณุชุงุฐ ูุชุฎุตุต ูู ${subject}. ุฃุฑูุฏ ููู ุฅูุดุงุก ุงุฎุชุจุงุฑ ุชูุงุนูู ุจุงูููุงุตูุงุช ุงูุชุงููุฉ:

**ุงููุงุฏุฉ:** ${subject}
**ูุณุชูู ุงูุตุนูุจุฉ:** ${difficulty}
**ุนุฏุฏ ุงูุฃุณุฆูุฉ:** ${count}
**ููุน ุงูุฃุณุฆูุฉ:** ${type}
**ุงูููุถูุน ุงููุญุฏุฏ:** ${topic || 'ุนุงู'}

**ุชุนูููุงุช ูููุฉ:**

1. **ุตูุบุฉ ุงูุฅุฌุงุจุฉ ุงููุทููุจุฉ:**
   ุงูุชุจ ุงูุงุฎุชุจุงุฑ ุจุงูุตูุบุฉ ุงูุชุงููุฉ ุจุฏูุฉ:

   QUIZ_START
   ุงูุณุคุงู 1: [ูุต ุงูุณุคุงู]
   ุฃ) [ุฎูุงุฑ ุฃ]
   ุจ) [ุฎูุงุฑ ุจ]
   ุฌ) [ุฎูุงุฑ ุฌ]
   ุฏ) [ุฎูุงุฑ ุฏ]
   ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: [ุงูุญุฑู ุงูุตุญูุญ]
   ุงูุชูุณูุฑ: [ุดุฑุญ ูุฎุชุตุฑ ููุฅุฌุงุจุฉ]
   ---
   ุงูุณุคุงู 2: [ูุต ุงูุณุคุงู]
   [ููุณ ุงูุชูุณูู]
   QUIZ_END

2. **ูุชุทูุจุงุช ุงูุฃุณุฆูุฉ:**
   - ุงุฌุนู ุงูุฃุณุฆูุฉ ูุชููุนุฉ ููููุฏุฉ
   - ุงุณุชุฎุฏู ูุตุทูุญุงุช ูุงููููุฉ ุฏูููุฉ
   - ุงุฌุนู ุงูุฎูุงุฑุงุช ููุทููุฉ ููุชูุงุฑุจุฉ
   - ุฃุถู ุชูุณูุฑุงู ูููุฏุงู ููู ุฅุฌุงุจุฉ

3. **ูุณุชูู ุงูุตุนูุจุฉ ${difficulty}:**
   ${difficulty === 'ุณูู' ? '- ุฃุณุฆูุฉ ุฃุณุงุณูุฉ ูููุงููู ุนุงูุฉ\n- ููุงุณุจุฉ ูููุจุชุฏุฆูู' : 
     difficulty === 'ูุชูุณุท' ? '- ุฃุณุฆูุฉ ุชุชุทูุจ ูููุงู ุฌูุฏุงู\n- ุชุทุจูู ุงูููุงููู' : 
     '- ุฃุณุฆูุฉ ูุชูุฏูุฉ ูุชุญููููุฉ\n- ููุงุณุจุฉ ููุงูุชุญุงูุงุช ุงูููุงุฆูุฉ'}

4. **ููุน ุงูุฃุณุฆูุฉ ${type}:**
   ${type === 'ุงุฎุชูุงุฑ ูุชุนุฏุฏ' ? 'ุฌููุน ุงูุฃุณุฆูุฉ ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ (4 ุฎูุงุฑุงุช)' :
     type === 'ุตุญ ูุฎุทุฃ' ? 'ุฌููุน ุงูุฃุณุฆูุฉ ุตุญ ูุฎุทุฃ (ุฎูุงุฑูู ููุท: ุตุญ/ุฎุทุฃ)' :
     type === 'ููุงูู' ? 'ุฃุณุฆูุฉ ููุงููุฉ ุชุชุทูุจ ุฅุฌุงุจุฉ ููุตูุฉ' :
     'ูุฒูุฌ ูู ุฃููุงุน ุงูุฃุณุฆูุฉ ุงููุฎุชููุฉ'}

ุงุจุฏุฃ ุงูุงุฎุชุจุงุฑ ุงูุขู:
            `;
        }

        function parseQuizData(quizText) {
            const questions = [];
            const lines = quizText.split('\n');
            let currentQuestion = null;
            let inQuiz = false;

            for (let line of lines) {
                line = line.trim();
                
                if (line === 'QUIZ_START') {
                    inQuiz = true;
                    continue;
                }
                
                if (line === 'QUIZ_END') {
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    break;
                }
                
                if (!inQuiz) continue;
                
                if (line.startsWith('ุงูุณุคุงู ') && line.includes(':')) {
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    currentQuestion = {
                        question: line.split(':').slice(1).join(':').trim(),
                        options: [],
                        correct: '',
                        explanation: ''
                    };
                } else if (line.match(/^[ุฃุงุจุฌุฏุฏ]\)/)) {
                    if (currentQuestion) {
                        currentQuestion.options.push(line);
                    }
                } else if (line.startsWith('ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ:')) {
                    if (currentQuestion) {
                        currentQuestion.correct = line.split(':')[1].trim();
                    }
                } else if (line.startsWith('ุงูุชูุณูุฑ:')) {
                    if (currentQuestion) {
                        currentQuestion.explanation = line.split(':').slice(1).join(':').trim();
                    }
                } else if (line === '---') {
                    // ูุงุตู ุจูู ุงูุฃุณุฆูุฉ
                    continue;
                }
            }
            
            if (currentQuestion && !questions.includes(currentQuestion)) {
                questions.push(currentQuestion);
            }
            
            return questions;
        }

        function displayQuiz(questions) {
            const quizContainer = document.getElementById('quiz-container');
            const questionsDiv = document.getElementById('quiz-questions');
            const resultDiv = document.getElementById('result');
            
            if (questions.length === 0) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>ูู ูุชู ุฅูุดุงุก ุงูุงุฎุชุจุงุฑ ุจุดูู ุตุญูุญ</h4>
                        <p>ุงูุฑุฌุงุก ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู</p>
                    </div>
                `;
                return;
            }

            let questionsHTML = '';
            
            questions.forEach((q, index) => {
                questionsHTML += `
                    <div class="quiz-question" data-question="${index}">
                        <h4>ุงูุณุคุงู ${index + 1}: ${q.question}</h4>
                        <div class="quiz-options">
                `;
                
                q.options.forEach((option, optIndex) => {
                    const optionLetter = option.charAt(0);
                    questionsHTML += `
                        <div class="quiz-option" onclick="selectOption(${index}, '${optionLetter}')">
                            <input type="radio" name="question_${index}" value="${optionLetter}" id="q${index}_${optIndex}">
                            <label for="q${index}_${optIndex}">${option}</label>
                        </div>
                    `;
                });
                
                questionsHTML += `
                        </div>
                    </div>
                `;
            });
            
            questionsDiv.innerHTML = questionsHTML;
            quizContainer.style.display = 'block';
            resultDiv.style.display = 'none';
        }

        function selectOption(questionIndex, optionLetter) {
            const radio = document.querySelector(`input[name="question_${questionIndex}"][value="${optionLetter}"]`);
            if (radio) {
                radio.checked = true;
            }
        }

        function startQuizTimer() {
            quizStartTime = Date.now();
            const timerElement = document.getElementById('timer');
            
            quizTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - quizStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function submitQuiz() {
            if (!currentQuiz) return;
            
            clearInterval(quizTimer);
            
            let score = 0;
            let totalQuestions = currentQuiz.length;
            let results = [];
            
            currentQuiz.forEach((question, index) => {
                const selectedOption = document.querySelector(`input[name="question_${index}"]:checked`);
                const selectedValue = selectedOption ? selectedOption.value : null;
                const isCorrect = selectedValue === question.correct;
                
                if (isCorrect) score++;
                
                results.push({
                    question: question.question,
                    selected: selectedValue,
                    correct: question.correct,
                    isCorrect: isCorrect,
                    explanation: question.explanation
                });
            });
            
            displayQuizResults(score, totalQuestions, results);
        }

        function displayQuizResults(score, total, results) {
            const percentage = Math.round((score / total) * 100);
            const passed = percentage >= 60;
            
            const resultDiv = document.getElementById('result');
            const quizContainer = document.getElementById('quiz-container');
            
            let resultsHTML = `
                <div class="quiz-result ${passed ? '' : 'fail'}">
                    <h3>ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ</h3>
                    <p><strong>ุงููุชูุฌุฉ:</strong> ${score} ูู ${total} (${percentage}%)</p>
                    <p><strong>ุงูุญุงูุฉ:</strong> ${passed ? 'โ ูุฌุญ' : 'โ ุฑุงุณุจ'}</p>
                    <p><strong>ุงูููุช ุงููุณุชุบุฑู:</strong> ${document.getElementById('timer').textContent}</p>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>ูุฑุงุฌุนุฉ ุงูุฃุณุฆูุฉ:</h4>
            `;
            
            results.forEach((result, index) => {
                const statusIcon = result.isCorrect ? 'โ' : 'โ';
                const statusColor = result.isCorrect ? '#28a745' : '#dc3545';
                
                resultsHTML += `
                    <div style="border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 8px;">
                        <p><strong>${statusIcon} ุงูุณุคุงู ${index + 1}:</strong> ${result.question}</p>
                        <p style="color: ${statusColor};"><strong>ุฅุฌุงุจุชู:</strong> ${result.selected || 'ูู ุชุฌุจ'}</p>
                        <p style="color: #28a745;"><strong>ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ:</strong> ${result.correct}</p>
                        ${result.explanation ? `<p style="color: #6c757d;"><strong>ุงูุชูุณูุฑ:</strong> ${result.explanation}</p>` : ''}
                    </div>
                `;
            });
            
            resultsHTML += '</div>';
            
            resultDiv.innerHTML = resultsHTML;
            resultDiv.style.display = 'block';
            quizContainer.style.display = 'none';
        }

        function resetQuiz() {
            if (quizTimer) {
                clearInterval(quizTimer);
            }
            
            currentQuiz = null;
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('timer').textContent = '00:00';
            
            // ุฅุนุงุฏุฉ ุชุนููู ุงูุญููู
            document.getElementById('quiz-subject').value = '';
            document.getElementById('quiz-difficulty').value = 'ุณูู';
            document.getElementById('quiz-count').value = '5';
            document.getElementById('quiz-type').value = 'ุงุฎุชูุงุฑ ูุชุนุฏุฏ';
            document.getElementById('quiz-topic').value = '';
        }

        function copyResult() {
            const resultText = document.getElementById('result').innerText;
            navigator.clipboard.writeText(resultText).then(() => {
                alert('ุชู ูุณุฎ ุงููุชูุฌุฉ ุจูุฌุงุญ!');
            }).catch(err => {
                console.error('ุฎุทุฃ ูู ุงููุณุฎ: ', err);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงููุณุฎ');
            });
        }

        function downloadResult() {
            const resultText = document.getElementById('result').innerText;
            const title = document.getElementById('research-title').value || 'ุงูุจุญุซ';
            
            const blob = new Blob([resultText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${title}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function printResult() {
            const resultContent = document.getElementById('result').innerHTML;
            const title = document.getElementById('research-title').value || 'ุงูุจุญุซ';
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>${title}</title>
                    <style>
                        body { 
                            font-family: 'Times New Roman', serif; 
                            line-height: 1.8; 
                            margin: 2cm; 
                            text-align: justify;
                        }
                        @page { margin: 2cm; }
                    </style>
                </head>
                <body>
                    ${resultContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
    </script>
</body>
</html>