// قاعدة بيانات المراجع الأكاديمية حسب المجال
const ACADEMIC_REFERENCES = {
    "قانون": [
        "د. عبد الرزاق السنهوري، الوسيط في شرح القانون المدني، دار النهضة العربية، القاهرة، 2019",
        "د. محمد حسن قاسم، المدخل إلى العلوم القانونية، دار الفكر الجامعي، الإسكندرية، 2020",
        "د. نبيل إبراهيم سعد، النظرية العامة للقانون، دار الجامعة الجديدة، الإسكندرية، 2021",
        "د. عمار بوضياف، النظرية العامة للقانون، دار ريحانة، الجزائر، 2020",
        "د. سليمان مرقس، المدخل للعلوم القانونية، دار النهضة العربية، القاهرة، 2019"
    ],
    "إدارة": [
        "د. محمد الصيرفي، الإدارة الحديثة، دار الفجر للنشر، القاهرة، 2020",
        "د. علي السلمي، إدارة الموارد البشرية الاستراتيجية، دار غريب، القاهرة، 2019",
        "د. ثابت عبد الرحمن إدريس، بحوث العمليات، الدار الجامعية، الإسكندرية، 2021",
        "د. أحمد ماهر، إدارة الأعمال، الدار الجامعية، الإسكندرية، 2020"
    ],
    "اقتصاد": [
        "د. رمزي زكي، مقدمة في علم الاقتصاد، دار النهضة العربية، القاهرة، 2020",
        "د. محمد دويدار، مبادئ الاقتصاد السياسي، دار المعرفة الجامعية، الإسكندرية، 2019",
        "د. عبد المطلب عبد الحميد، النظرية الاقتصادية، دار النهضة العربية، القاهرة، 2021"
    ],
    "علوم سياسية": [
        "د. حامد ربيع، النظرية السياسية المعاصرة، دار الموقف العربي، القاهرة، 2020",
        "د. إسماعيل صبري مقلد، العلاقات السياسية الدولية، دار النهضة العربية، القاهرة، 2019",
        "د. محمد السيد سليم، تحليل السياسة الخارجية، مكتبة النهضة المصرية، القاهرة، 2021"
    ],
    "تاريخ": [
        "د. عبد العزيز الدوري، مقدمة في التاريخ الاقتصادي العربي، مركز دراسات الوحدة العربية، بيروت، 2019",
        "د. شوقي ضيف، تاريخ الأدب العربي، دار المعارف، القاهرة، 2020",
        "د. محمد الخضري، تاريخ الأمم الإسلامية، مكتبة التراث الإسلامي، القاهرة، 2021"
    ]
};

// دالة لاختيار مراجع عشوائية من المجال المحدد
function getRandomReferences(field, count = 5) {
    const fieldRefs = ACADEMIC_REFERENCES[field] || ACADEMIC_REFERENCES["قانون"];
    const shuffled = fieldRefs.sort(() => 0.5 - Math.random());
    return shuffled.slice(0, Math.min(count, fieldRefs.length));
}

// دالة لتنسيق المراجع بالطريقة الأكاديمية
function formatReferences(references) {
    return references.map((ref, index) => `(${index + 1}) ${ref}`).join('\n');
}

// دالة لإنشاء هوامش للنص
function addFootnotes(text, field) {
    const references = getRandomReferences(field, 8);
    let footnoteCounter = 1;
    
    // إضافة الهوامش في نهاية الفقرات المهمة
    text = text.replace(/(\.)\s*\n/g, (match, p1) => {
        if (Math.random() < 0.3 && footnoteCounter <= references.length) { // 30% احتمال إضافة هامش
            return `${p1} (${footnoteCounter++})\n`;
        }
        return match;
    });
    
    return {
        text: text,
        footnotes: references.slice(0, footnoteCounter - 1)
    };
}

// قاموس المصطلحات القانونية
const LEGAL_TERMS = {
    "القانون": "مجموعة القواعد العامة المجردة التي تنظم سلوك الأفراد في المجتمع",
    "القاعدة القانونية": "قاعدة سلوك عامة ومجردة وملزمة تستهدف تنظيم العلاقات الاجتماعية",
    "الجزاء": "النتيجة المترتبة على مخالفة القاعدة القانونية",
    "السلطة التشريعية": "السلطة المختصة بوضع القوانين في الدولة",
    "التقنين": "جمع القواعد القانونية المتعلقة بموضوع معين في نص موحد"
};

// دالة لإضافة تعريفات المصطلحات
function addTermDefinitions(text) {
    Object.keys(LEGAL_TERMS).forEach(term => {
        const definition = LEGAL_TERMS[term];
        const regex = new RegExp(`\\b${term}\\b`, 'g');
        // إضافة التعريف في أول مرة يظهر فيها المصطلح
        if (text.includes(term) && !text.includes(definition)) {
            text = text.replace(regex, `${term} - وهو ${definition} -`);
        }
    });
    return text;
}

// تصدير الدوال للاستخدام في الملفات الأخرى
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        getRandomReferences,
        formatReferences,
        addFootnotes,
        addTermDefinitions,
        ACADEMIC_REFERENCES,
        LEGAL_TERMS
    };
}